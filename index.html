<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
<link rel="icon" href="icons/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<!-- Firebase SDK Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
<style>
:root{
  --accent1:#60a5fa; --accent2:#7c3aed;
  --bg-grad: linear-gradient(90deg,var(--accent1),var(--accent2));
  --card:#ffffff; --text:#071127; --muted:#475569;
  --cell-border: rgba(2,6,23,0.06);
  --th-bg: rgba(0,0,0,0.03);
  transition: all 0.3s ease; /* Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ù„Ø³ Ù„Ù„Ø«ÙŠÙ… */
}
[data-theme="dark"]{
  --card:#071127; --text:#e6eef8; --muted:#9ca3af; --cell-border: rgba(255,255,255,0.06);
  --bg-grad: linear-gradient(90deg,#0f172a,#0b1220);
  --th-bg: rgba(255,255,255,0.06);
}
*{box-sizing:border-box}
body{margin:0;font-family:'Cairo',sans-serif;background:var(--bg-grad);color:var(--text);min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:18px}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;color:white}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:52px;height:52px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-size:28px}
.title{font-size:20px;font-weight:800}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:white;color:#3730a3;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;transition: all 0.3s ease;} /* Ø¥Ø¶Ø§ÙØ© transition Ù„Ù„Ø²Ø± */
.btn:hover{background:var(--accent1);color:white;} /* hover Ù…Ø¹ accent1 */
.small-btn{background:transparent;border:1px solid rgba(255,255,255,0.18);color:white;padding:6px 10px;border-radius:8px;cursor:pointer;transition: all 0.3s ease;}
.small-btn:hover{background:rgba(255,255,255,0.12);}
.info-badge{background:rgba(255,255,255,0.16);padding:6px 10px;border-radius:8px;font-size:13px}
.nav{display:flex;gap:8px;margin:12px 0}
.tab-btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:rgba(255,255,255,0.12);color:white;font-weight:700}
.tab-btn.active{background:white;color:#3730a3}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(2,6,23,0.12);color:var(--text)}
.table-wrap{overflow:auto}
.table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden}
.table th, .table td{border:1px solid var(--cell-border);padding:10px;text-align:center;font-size:14px}
.table th{background:var(--th-bg);font-weight:800}
.slot{padding:6px;border-radius:6px}
.slot .meta{font-size:12px;color:var(--muted);margin-top:6px}
.empty{opacity:0.45}
.current{outline:3px solid rgba(124,58,237,0.18);box-shadow:0 6px 18px rgba(124,58,237,0.08)}
.legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.legend-item{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.06);font-size:13px}
.footer{padding:12px;text-align:center;color:rgba(255,255,255,0.9);opacity:0.9;margin-top:12px}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:9999}
.modal{width:100%;max-width:900px;background:var(--card);border-radius:12px;padding:16px;color:var(--text);max-height:90vh;overflow:auto}
.input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:6px}
.row{display:flex;gap:8px}
.col{flex:1}
.kv{font-size:13px;color:var(--muted)}
.top-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.days-tabs{display:flex;gap:6px;flex-wrap:wrap}
.day-tab{padding:6px 10px;border-radius:8px;border:none;cursor:pointer;background:rgba(15,23,42,0.03)}
.day-tab.active{background:var(--accent2);color:white}
@media (max-width:900px){
  .header-row{flex-direction:column;align-items:flex-start}
  .row{flex-direction:column}
  .table th, .table td{font-size:12px;padding:8px}
}
.notice-small{font-size:13px;color:rgba(255,255,255,0.9);opacity:0.95;margin-top:6px}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}

/* Ø¥Ø¶Ø§ÙØ§Øª Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
.live-countdown {
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
.upcoming-soon {
  background: rgba(255, 215, 0, 0.2) !important;
  border-color: #ffd700 !important;
  animation: shake 0.5s;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ØªØµÙ…ÙŠÙ…) */
#subscribeBtn {
  background: white;
  color: #3730a3;
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 700;
  font-family: 'Cairo', sans-serif;
  transition: all 0.3s ease;
  margin: 0 8px; /* gap Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */
}
#subscribeBtn:hover {
  background: var(--accent1); /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ù…Ù† Ø§Ù„Ù€ accent */
  color: white;
  box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3); /* Ø¸Ù„ Ø®ÙÙŠÙ */
}
#status {
  background: rgba(255,255,255,0.16); /* Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù€ info-badge */
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 13px;
  color: white;
  opacity: 0.9;
  margin: 0;
  display: inline-block;
}
[data-theme="dark"] #status {
  background: rgba(255,255,255,0.1); /* ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
}
</style>
</head>
<body>
<div class="container">
  <div class="header-row">
    <div class="brand">
      <div class="logo">ğŸ“˜</div>
      <div>
        <div class="title">ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
        <div class="notice-small">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹</div>
      </div>
    </div>
    <div class="controls">
      <div id="liveNotice" class="info-badge">Ø­Ø³Ø§Ø¨...</div>
      <!-- Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ØªØµÙ…ÙŠÙ… (Ø¯Ø§Ø®Ù„ controls Ù…Ø¹ gap) -->
      <button id="subscribeBtn" onclick="requestPermission()">ÙØ¹Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ğŸ””</button>
      <span id="status"></span> <!-- status Ù‡Ù†Ø§ Ù„Ù„Ø¹Ø±Ø¶ -->
      <div style="display:flex;gap:8px;align-items:center">
        <button id="exportBtn" class="small-btn" title="ØªØµØ¯ÙŠØ± JSON">ØªØµØ¯ÙŠØ±</button>
        <button id="importBtn" class="small-btn" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <button id="printBtn" class="small-btn" title="ØªØ­Ù…ÙŠÙ„ PDF">ØªØ­Ù…ÙŠÙ„ PDF</button>
        <button id="adminBtn" class="btn" title="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        <button id="themeToggle" class="small-btn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">Ø§Ù„ÙˆØ¶Ø¹</button>
      </div>
    </div>
  </div>

  <nav class="nav">
    <button class="tab-btn active" data-tab="weekly">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
    <button class="tab-btn" data-tab="day">Ø§Ù„ÙŠÙˆÙ…</button>
    <button class="tab-btn" data-tab="instructors">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button>
  </nav>

  <main>
    <!-- Weekly Tab -->
    <section id="tab-weekly" class="card table-wrap">
      <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
      <div class="top-actions" style="margin-bottom:8px">
        <div class="kv">Ø³Ø§Ø¹Ø§Øª: 8:00 Øµ â†’ 10:00 Ù…</div>
        <div id="legend" class="legend"></div>
      </div>
      <div id="tableContainer"></div>
    </section>

    <!-- Day Tab -->
    <section id="tab-day" class="card" style="display:none;margin-top:12px">
      <h3>Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
      <div class="days-tabs" id="daysTabs"></div>
      <div id="dayContainer" style="margin-top:12px"></div>
    </section>

    <!-- Instructors Tab -->
    <section id="tab-instructors" class="card" style="display:none;margin-top:12px">
      <h3>Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</h3>
      <div id="instructorList" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px"></div>
    </section>

    <section class="card" style="margin-top:12px">
      <h4>ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni ğŸ’»</h4>
    </section>
  </main>

  <footer class="footer">Â© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</footer>
</div>

<div id="modalRoot" style="display:none"></div>

<script>
/* Firebase Config (ØºÙŠØ± Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Firebase console!) â€“ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù…Ø¹ try-catch */
let messaging; // global Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
const SERVER_KEY = 'YOUR_ACTUAL_SERVER_KEY_HERE'; // ØºÙŠÙ‘Ø± Ø¯Ù‡ Ø¨Ù€ Server Key Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Firebase Console > Project Settings > Cloud Messaging > Server key
try {
  const firebaseConfig = {
    apiKey: "AIzaSyCNxv8rljPPLks03giwrjrIv018MdZkSoM",
    authDomain: "jadwal-app-12d0c.firebaseapp.com",
    projectId: "jadwal-app-12d0c",
    storageBucket: "jadwal-app-12d0c.firebasestorage.app",
    messagingSenderId: "599880482581",
    appId: "1:599880482581:web:21d65c1aacfa68b83d331c",
  measurementId: "G-LM8SPG04XK"
  };
  firebase.initializeApp(firebaseConfig);
  messaging = firebase.messaging();
  console.log('Firebase initialized successfully');

  // Foreground messages (Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ù…ÙØªÙˆØ­Ø©)
  messaging.onMessage((payload) => {
    console.log('Foreground message: ', payload);
    // Ø¹Ø±Ø¶ alert Ø£Ùˆ toast ÙÙŠ Ø§Ù„ØµÙØ­Ø© (ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµÙ‡ Ù„Ø§Ø­Ù‚Ù‹Ø§)
    alert(payload.notification?.body || 'ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„!');
  });

} catch (error) {
  console.error('Firebase initialization failed (config not set yet):', error);
  messaging = null; // Ù„ØªØ¬Ù†Ø¨ Ø£Ø®Ø·Ø§Ø¡ Ù„Ø§Ø­Ù‚Ø©
}

// ØªØ³Ø¬ÙŠÙ„ service worker Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø¹ try-catch Ù„Ù„Ø£Ù…Ø§Ù†)
if ('serviceWorker' in navigator && messaging) {
  navigator.serviceWorker.register('/firebase-messaging-sw.js')
    .then((registration) => { 
      console.log('SW registered for notifications:', registration); 
    })
    .catch((error) => { 
      console.error('SW registration failed:', error); 
    });
}

/* Config */
const ENCODED_PASSWORD = 'S2hhbGVkMjExMCU='; // 'Khaled2110%'
const ADMIN_PASSWORD = atob(ENCODED_PASSWORD); // decode Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
const STORAGE_KEY_THEME = 'jadwal_theme';
const STORAGE_KEY_DATA = 'jadwal_data'; // Ù…ÙØªØ§Ø­ Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§
const DAYS = ['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'];
const HOURS = Array.from({length:15},(_,i)=>8+i); // 8 Øµ Ø¥Ù„Ù‰ 10 Ù… (15 Ø³Ø§Ø¹Ø©)

/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø«Ø§Ø¨ØªØ© (hardcode) â€“ Ø¹Ø¯Ù„Ù‡Ø§ Ù‡Ù†Ø§ ÙˆØ§Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ù„Ù„ÙƒÙ„ */
let DATA = {
  lectures: [
  {
    "id": "idmgmpsika3qsxarr",
    "day": "Ø§Ù„Ø³Ø¨Øª",
    "startHour": 10,
    "startMin": 0,
    "endHour": 14,
    "endMin": 0,
    "title": "Ø£Ø³Ø§Ø³ÙŠØ§Øª ØªÙ…Ø±ÙŠØ¶ Ù†Ø¸Ø±ÙŠ",
    "instructorId": "idmgmppo05hohhc2a",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
      },
  {
    "id": "idmgmpsz94t0e99l6",
    "day": "Ø§Ù„Ø£Ø­Ø¯",
    "startHour": 19,
    "startMin": 0,
    "endHour": 20,
    "endMin": 0,
    "title": "Ø¹Ù„Ù… Ø§Ù„Ø£Ø¯ÙˆÙŠØ©",
    "instructorId": "idmgmppuxcbxi1den",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmptfeanvioois",
    "day": "Ø§Ù„Ø³Ø¨Øª",
    "startHour": 20,
    "startMin": 0,
    "endHour": 22,
    "endMin": 0,
    "title": "Ù‚Ø¶Ø§ÙŠØ§ Ù…Ø¬ØªÙ…Ø¹ÙŠØ©",
    "instructorId": "idmgmpq3h21xx212z",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmpug13730m16c",
    "day": "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
    "startHour": 11,
    "startMin": 0,
    "endHour": 13,
    "endMin": 0,
    "title": "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
    "instructorId": "idmgmpqa5qqyf0nzw",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmpv1ngk5va8mo",
    "day": "Ø§Ù„Ø£Ø­Ø¯",
    "startHour": 11,
    "startMin": 0,
    "endHour": 13,
    "endMin": 0,
    "title": "Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„",
    "instructorId": "idmgmpqgwlzfuzmfp",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmpvuvji5i63d0",
    "day": "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
    "startHour": 9,
    "startMin": 0,
    "endHour": 11,
    "endMin": 0,
    "title": "Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ø©",
    "instructorId": "idmgmpqp7cjku2mud",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmpwc4otaxwt8k",
    "day": "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
    "startHour": 9,
    "startMin": 0,
    "endHour": 11,
    "endMin": 0,
    "title": "Ø§Ù„ØªØºØ°ÙŠØ©",
    "instructorId": "idmgmpr2vt4aplmm6",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmpwxfmvhiz0pz",
    "day": "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
    "startHour": 11,
    "startMin": 0,
    "endHour": 13,
    "endMin": 0,
    "title": "Ø§Ù„ØªØ«Ù‚ÙŠÙ Ø§Ù„ØµØ­ÙŠ",
    "instructorId": "idmgmpreo1qm5kzsv",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmq4y5wueq1ygn",
    "day": "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",
    "startHour": 11,
    "startMin": 0,
    "endHour": 17,
    "endMin": 0,
    "title": "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ø¹Ù…Ù„ÙŠ)",
    "instructorId": "idmgmprrsmw1qub9g",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmq5mhj66lo0na",
    "day": "Ø§Ù„Ø®Ù…ÙŠØ³",
    "startHour": 8,
    "startMin": 0,
    "endHour": 14,
    "endMin": 0,
    "title": "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ø¹Ù…Ù„ÙŠ)",
    "instructorId": "idmgmprrsmw1qub9g",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  },
  {
    "id": "idmgmq7f7285cuk9i",
    "day": "Ø§Ù„Ø®Ù…ÙŠØ³",
    "startHour": 18,
    "startMin": 0,
    "endHour": 19,
    "endMin": 0,
    "title": "Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© 2",
    "instructorId": "idmgmq6jaotttg27g",
    "instructorName": null,
    "location": ".",
    "notes": "",
    "link": ""
  }
],
  instructors: [
  {
    "id": "idmgmppo05hohhc2a",
    "name": "Ø¯.Ø¯Ø¹Ø§Ø¡ Ø£Ù…ÙŠÙ† \\ Ø¯.Ø£Ø³Ù…Ø§Ø¡ Ø´Ø­Ø§ØªÙ‡",
    "title": "",
    "subjects": [
      "Ø£Ø³Ø§Ø³ÙŠØ§Øª ØªÙ…Ø±ÙŠØ¶ Ù†Ø¸Ø±ÙŠ"
    ],
    "bio": ""
  },
  {
    "id": "idmgmppuxcbxi1den",
    "name": "Ø¯.ÙŠØ§Ø³Ù…ÙŠÙ† Ø¹Ø·ÙŠØ©",
    "title": "",
    "subjects": [
      "Ø¹Ù„Ù… Ø§Ù„Ø£Ø¯ÙˆÙŠØ©"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpq3h21xx212z",
    "name": "Ø¯.Ø¨Ø³Ù…Ø© Ø·Ø§Ù‡Ø±",
    "title": "",
    "subjects": [
      "Ù‚Ø¶Ø§ÙŠØ§ Ù…Ø¬ØªÙ…Ø¹ÙŠØ©"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpqa5qqyf0nzw",
    "name": "Ø¯.Ø£Ø³Ù…Ø§Ø¡ Ù…Ø­Ù‰ Ø§Ù„Ø¯ÙŠÙ† \\ Ø¯.Ø³Ø¹Ø§Ø¯ Ø¹Ø±ÙØ©",
    "title": "",
    "subjects": [
      "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpqgwlzfuzmfp",
    "name": "Ø¯.Ù…Ø±ÙˆØ© ÙØ¤Ø§Ø¯ \\ Ø¯.Ø¥ÙŠÙ…Ø§Ù† Ø§Ù„Ø³Ù‚Ø§",
    "title": "",
    "subjects": [
      "Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpqp7cjku2mud",
    "name": "Ø¯.Ø£Ù…Ù„ Ø¬Ù…Ø§Ù„",
    "title": "",
    "subjects": [
      "Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ø©"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpr2vt4aplmm6",
    "name": "Ø¯.Ø¬ÙŠÙ‡Ø§Ù† Ø§Ù„Ø²Ù„Ø¨Ø§Ù†ÙŠ",
    "title": "",
    "subjects": [
      "Ø§Ù„ØªØºØ°ÙŠØ©"
    ],
    "bio": ""
  },
  {
    "id": "idmgmpreo1qm5kzsv",
    "name": "Ø¯.Ø³Ø§Ù„ÙŠ ÙØ§ÙŠØ¯ \\ Ø¯.Ø¥ÙŠÙ…Ø§Ù† Ø¹Ù†Ø§Ù†",
    "title": "",
    "subjects": [
      "Ø§Ù„ØªØ«Ù‚ÙŠÙ Ø§Ù„ØµØ­ÙŠ"
    ],
    "bio": ""
  },
  {
    "id": "idmgmprrsmw1qub9g",
    "name": "Ù… \\ Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø§Ù† â€“ Ù…\\ Ø§Ø³Ø±Ø§Ø¡ Ø§Ù„Ø³Ø¹ÙŠØ¯ â€“ Ù…\\ Ù…Ø±ÙŠÙ… Ø±Ø¨ÙŠØ¹",
    "title": "",
    "subjects": [
      "Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ¶ (Ø¹Ù…Ù„ÙŠ)"
    ],
    "bio": ""
  },
  {
    "id": "idmgmq6jaotttg27g",
    "name": "Ø¯.Ø§Ø¨ØªØ³Ø§Ù… Ø§Ù„Ø´Ù‚Ø±ÙˆÙÙŠ",
    "title": "",
    "subjects": [
      "Ù„ØºØ© Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©"
    ],
    "bio": ""
  }
],
  changes: []
};
window.isAdmin = false;

/* Time helpers */
function to12(h){ const period = h>=12 ? 'Ù…' : 'Øµ'; let hh = h%12; if(hh===0) hh=12; return hh + ':00 ' + period; }
function to12WithMin(h,m){ const hour = parseInt(h,10); const period = hour>=12 ? 'Ù…' : 'Øµ'; let hh = hour%12; if(hh===0) hh=12; return hh + ':' + String(m).padStart(2,'0') + ' ' + period; }

/* Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (12 Ø³Ø§Ø¹Ø© Ø¨Ø¯ÙˆÙ† :00) */
function displayHour(h) {
  const period = h >= 12 ? 'Ù…' : 'Øµ';
  let hh = h % 12;
  if (hh === 0) hh = 12;
  return hh + ' ' + period;
}

/* Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (Ù…ØµØ±ØŒ UTC+2) */
function getCairoTime() {
  const now = new Date();
  const cairoTime = new Intl.DateTimeFormat('en-US', {
    timeZone: 'Africa/Cairo',
    year: 'numeric',
    month: 'numeric',
    day: 'numeric',
    hour: 'numeric',
    minute: 'numeric',
    second: 'numeric',
    hour12: false
  }).formatToParts(now);
  const year = parseInt(cairoTime.find(p => p.type === 'year').value);
  const month = parseInt(cairoTime.find(p => p.type === 'month').value) - 1; // JS months 0-based
  const day = parseInt(cairoTime.find(p => p.type === 'day').value);
  const hour = parseInt(cairoTime.find(p => p.type === 'hour').value);
  const minute = parseInt(cairoTime.find(p => p.type === 'minute').value);
  const second = parseInt(cairoTime.find(p => p.type === 'second').value);
  return new Date(year, month, day, hour, minute, second);
}

/* Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (Ø§Ù„Ø³Ø¨Øª = 0) */
function getCairoDayIndex() {
  const cairoNow = getCairoTime();
  let jsDay = cairoNow.getDay(); // JS: Sunday=0, Saturday=6
  return (jsDay + 1) % 7; // ØªØ­ÙˆÙŠÙ„: Saturday=0, Sunday=1, ..., Friday=6
}

/* Data helpers (Ø­ÙØ¸/ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage Ù„Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠ) */
function uid(){ return 'id' + Date.now().toString(36) + Math.random().toString(36).slice(2,9); }
function saveTheme(theme){ localStorage.setItem(STORAGE_KEY_THEME, theme); }
function loadTheme(){ return localStorage.getItem(STORAGE_KEY_THEME) || 'light'; }
function saveDataToLocal() {
  try {
    localStorage.setItem(STORAGE_KEY_DATA, JSON.stringify(DATA));
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage:', e);
  }
}
function loadDataFromLocal() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY_DATA);
    if (saved) {
      const parsed = JSON.parse(saved);
      if (parsed.lectures && parsed.instructors) {
        DATA = parsed;
        console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage');
      }
    }
  } catch (e) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
  }
}
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* Color per subject */
const colorCache={};
function genColor(title){ 
  if(!title) return {bg:'rgba(243,244,246,0.6)',solid:'#e5e7eb'}; 
  if(colorCache[title]) return colorCache[title]; 
  let h=0; 
  for(let i=0;i<title.length;i++){ h=(h<<5)-h+title.charCodeAt(i); h|=0; } 
  const r=Math.abs(h)%200+20;   const g=(Math.abs(h*13)%150)+80; 
  const b=(Math.abs(h*7)%180)+40; 
  const bg='rgba('+r+','+g+','+b+',0.18)'; 
  const solid='rgba('+r+','+g+','+b+',0.95)'; 
  colorCache[title]={bg,solid}; 
  return colorCache[title]; 
}

/* Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ error handling ÙˆØªØ­Ø¯ÙŠØ« token) */
async function requestPermission() {
  try {
    if (!messaging) {
      document.getElementById('status').textContent = 'Firebase ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ â€“ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.';
      document.getElementById('status').style.color = 'red';
      return;
    }
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      const token = await messaging.getToken({ vapidKey: 'BOcsE4nI5fIDQW8hFa-43M1IGZUAl13oDNaI5MkTR8BCvy9CVoExINdp9xLg_PLaWWyL-dsJHPmAlccuS2Xt7vs' });  // VAPID key Ù…Ù† Firebase
      if (token) {
        // Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ topic
        await messaging.subscribeToTopic(token, 'jadwal-updates');
        console.log('Token generated and subscribed:', token);
        document.getElementById('status').textContent = 'ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„! Ø³ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª.';
        document.getElementById('status').style.color = 'green';
      } else {
        throw new Error('ÙØ´Ù„ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù€ token');
      }
    } else {
      document.getElementById('status').textContent = 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø© â€“ ÙØ¹Ù„Ù‡Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.';
      document.getElementById('status').style.color = 'orange';
    }
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
    document.getElementById('status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â€“ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
    document.getElementById('status').style.color = 'red';
  }
}

/* Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± (Ù…Ø­Ø¯Ø«Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± FCM REST API Ù…Ø¹ Server Key) */
async function sendNotification() {
  if (!messaging || SERVER_KEY === 'YOUR_ACTUAL_SERVER_KEY_HERE') {
    alert('Server Key ØºÙŠØ± Ù…Ø­Ø¯Ø¯ â€“ Ø§Ø³ØªØ®Ø¯Ù… Firebase Console Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø£Ùˆ Ø£Ø¶Ù Ø§Ù„Ù€ Key.');
    return;
  }
  const message = {
    notification: {
      title: 'ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª! ğŸ””',
      body: 'ØªÙ… ØªØºÙŠÙŠØ± Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© â€“ Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø±Ø¤ÙŠØ©.'
    },
        topic: 'jadwal-updates'
  };
  try {
    const response = await fetch('https://fcm.googleapis.com/fcm/send', {
      method: 'POST',
      headers: {
        'Authorization': `key=${SERVER_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(message)
    });
    if (response.ok) {
      console.log('Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±Ø³Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø·Ù„Ø¨Ø©!');
    } else {
      throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + response.status);
    }
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€“ Ø¬Ø±Ø¨ Ù…Ù† Firebase Console Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Cloud Functions.');
  }
}

/* Render weekly table (Ù…ØµØ­Ø­Ø© Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­ title element) */
function renderTable(){
  const container=document.getElementById('tableContainer'); 
  if(!container) return; 
  container.innerHTML='';
  const table=document.createElement('table'); 
  table.className='table';
  const thead=document.createElement('thead'); 
  const headRow=document.createElement('tr'); 
  headRow.appendChild(document.createElement('th'));  // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·
  HOURS.forEach((h,idx)=>{
    const th=document.createElement('th'); 
    const next = HOURS[idx+1] || (h+1); 
    th.innerText = displayHour(h) + ' - ' + displayHour(next); 
    headRow.appendChild(th); 
  });
  thead.appendChild(headRow); 
  table.appendChild(thead);
  const tbody=document.createElement('tbody');
  const map={};
  (DATA.lectures||[]).forEach(l=>{ if (!l.day) return; map[l.day]=map[l.day]||[]; map[l.day].push(l); });
  DAYS.forEach(day=>{
    const tr=document.createElement('tr'); 
    const dayCell=document.createElement('th'); 
    dayCell.innerText=day; 
    tr.appendChild(dayCell);
    const occ = new Array(HOURS.length).fill(null);
        (map[day]||[]).forEach(l=>{
      const startNum = l.startHour + ((l.startMin||0)/60);
      const endNum = l.endHour + ((l.endMin||0)/60);
      const startIdx = Math.max(0, Math.floor(startNum - HOURS[0]));
      const span = Math.max(1, Math.ceil(endNum - startNum));
      if(startIdx < occ.length){
        occ[startIdx] = occ[startIdx] || [];
        occ[startIdx].push({lec:l, span:span});
        for(let k=1;k<span && (startIdx+k)<occ.length;k++) occ[startIdx+k] = 'skip';
      }
    });
    for(let i=0;i<HOURS.length;i++){
      const cell = occ[i];
      if(cell === 'skip') continue;
      const td=document.createElement('td');
      if(cell === null){
        td.innerHTML = '<div class="slot empty">'+displayHour(HOURS[i])+' â€” ÙØ§Ø±Øº</div>';
        tr.appendChild(td);
      } else {
        const maxSpan = Math.max(...cell.map(c=>c.span));
        if(maxSpan>1) td.colSpan = maxSpan;
        const box=document.createElement('div');
        cell.forEach(cobj=>{
          const lec = cobj.lec;
          const col = genColor(lec.title);
          const div=document.createElement('div'); 
          div.className='slot'; 
          div.style.background = col.bg; 
          div.style.borderRadius='8px'; 
          div.style.padding='6px'; 
          div.style.marginBottom='6px';

          // Ø¥ØµÙ„Ø§Ø­: Ø¥Ù†Ø´Ø§Ø¡ title Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
          const title = document.createElement('div');
          title.style.fontWeight = '800';
          title.style.color = col.solid;
          title.innerText = lec.title;

          const meta=document.createElement('div'); 
          meta.className='meta'; 
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø§Ø¨Ø·: Ù„Ùˆ location Ø±Ø§Ø¨Ø·ØŒ Ø§Ø¹Ø±Ø¶ "Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†"ØŒ ÙˆØ£Ø¶Ù Ø±Ø§Ø¨Ø· clickable ØªØ­Øª
          let locationText = lec.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          let isLink = false;
          if (lec.location && (lec.location.startsWith('http://') || lec.location.startsWith('https://'))) {
            locationText = 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†';
            isLink = true;
          }
          meta.innerText = (getInstructorName(lec.instructorId)||lec.instructorName||'') + ' â€¢ ' + locationText;
          const timeEl=document.createElement('div'); 
          timeEl.className='meta'; 
          timeEl.innerText = to12WithMin(lec.startHour,lec.startMin||0) + ' â€” ' + to12WithMin(lec.endHour,lec.endMin||0);
          div.appendChild(title); 
          div.appendChild(meta); 
          div.appendChild(timeEl);
          // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· clickable Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø·
          if (isLink) {
            const a=document.createElement('a'); 
            a.href=lec.location; 
            a.target='_blank'; 
            a.innerText='Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'; 
            a.style.display='block'; 
            a.style.marginTop='6px'; 
            a.style.color = col.solid;
            a.style.textDecoration = 'none';
            a.style.fontSize = '12px';
            div.appendChild(a); 
          }
          // admin actions
          if(window.isAdmin){
            const actions=document.createElement('div'); 
            actions.style.marginTop='6px'; 
            actions.style.display='flex'; 
            actions.style.justifyContent='flex-end'; 
            actions.style.gap='6px';
            const delBtn=document.createElement('button'); 
            delBtn.className='small-btn admin-only';  // Ø¥Ø¶Ø§ÙØ© class Ù„Ù„Ø¥Ø®ÙØ§Ø¡
            delBtn.title='Ø­Ø°Ù'; 
            delBtn.innerText='ğŸ—‘ï¸';
            delBtn.onclick = (ev)=>{ 
              ev.stopPropagation(); 
              if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')){ 
                const lecTitle = lec.title;
                DATA.lectures = DATA.lectures.filter(x=> x.id !== lec.id); 
                saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
                renderAll(); 
                recordChange('Ø­ÙØ°ÙØª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©: ' + lecTitle); 
                sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø°Ù
              } 
            };
            const editBtn=document.createElement('button'); 
            editBtn.className='small-btn admin-only';  // Ø¥Ø¶Ø§ÙØ© class Ù„Ù„Ø¥Ø®ÙØ§Ø¡
            editBtn.title='ØªØ¹Ø¯ÙŠÙ„'; 
            editBtn.innerText='âœï¸';
            editBtn.onclick = (ev)=>{ 
              ev.stopPropagation(); 
              openEditModal(lec); 
            };
            actions.appendChild(editBtn); 
            actions.appendChild(delBtn);
            div.appendChild(actions);
          }
          if(isNowInLecture(lec)) div.classList.add('current');
          box.appendChild(div);
        });
        td.appendChild(box); 
        tr.appendChild(td);
        i += ((td.colSpan||1)-1);
      }
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); 
  container.appendChild(table); 
  renderLegend();
  renderLiveNotice();
  renderChangeLog();
}

/* Render day tabs and day view (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© admin-only classes) */
function renderDaysTabs(){
  const daysTabs=document.getElementById('daysTabs'); 
  if(!daysTabs) return;
  daysTabs.innerHTML='';
  DAYS.forEach(d=>{ 
    const btn=document.createElement('button'); 
    btn.className='day-tab'; 
    btn.innerText=d; 
    btn.onclick=()=> showDay(d); 
    daysTabs.appendChild(btn); 
  });
  // activate today by default (Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©)
  const todayIndex = getCairoDayIndex();
  const today = DAYS[todayIndex];
  showDay(today);
}

function showDay(day){
  document.querySelectorAll('.day-tab').forEach(b=> b.classList.toggle('active', b.innerText===day));
  const container=document.getElementById('dayContainer'); 
  if(!container) return;
  container.innerHTML='';
  const lectures=(DATA.lectures||[]).filter(l=> l.day===day).sort((a,b)=> (a.startHour+(a.startMin||0)/60)-(b.startHour+(b.startMin||0)/60));
  if(lectures.length===0){ 
    container.innerHTML='<div class="card">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>'; 
    return; 
  }
  lectures.forEach(lec=>{
    const card=document.createElement('div'); 
    card.className='card'; 
    card.style.marginBottom='8px';
    const title=document.createElement('div'); 
    title.style.fontWeight='800'; 
    title.innerText=lec.title;
    const meta=document.createElement('div'); 
    meta.className='kv'; 
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø§Ø¨Ø·: Ù„Ùˆ location Ø±Ø§Ø¨Ø·ØŒ Ø§Ø¹Ø±Ø¶ "Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†"ØŒ ÙˆØ£Ø¶Ù Ø±Ø§Ø¨Ø· clickable ØªØ­Øª
    let locationText = lec.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    let isLink = false;
    if (lec.location && (lec.location.startsWith('http://') || lec.location.startsWith('https://'))) {
      locationText = 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†';
      isLink = true;
    }
    meta.innerText=(getInstructorName(lec.instructorId)||lec.instructorName||'') + ' â€¢ ' + locationText;
    const timeEl=document.createElement('div'); 
    timeEl.className='kv'; 
    timeEl.innerText = to12WithMin(lec.startHour,lec.startMin||0) + ' â€” ' + to12WithMin(lec.endHour,lec.endMin||0);
    card.appendChild(title); 
    card.appendChild(meta); 
    card.appendChild(timeEl);
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· clickable Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø·
    if (isLink) {
      const a=document.createElement('a'); 
      a.href=lec.location; 
      a.target='_blank'; 
      a.innerText='Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'; 
      a.style.display='block'; 
      a.style.marginTop='6px'; 
      a.style.color = 'var(--accent1)';
      a.style.textDecoration = 'none';
      card.appendChild(a); 
    }
    // admin actions
    if(window.isAdmin){
      const actions = document.createElement('div'); 
      actions.style.marginTop='8px'; 
      actions.style.display='flex'; 
      actions.style.justifyContent='flex-end'; 
      actions.style.gap='6px';
      const delBtn = document.createElement('button'); 
      delBtn.className='small-btn admin-only';  // Ø¥Ø¶Ø§ÙØ© class Ù„Ù„Ø¥Ø®ÙØ§Ø¡
      delBtn.innerText='ğŸ—‘ï¸'; 
      delBtn.onclick=()=>{ 
        if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')){ 
          const lecTitle = lec.title;
          DATA.lectures = DATA.lectures.filter(x=> x.id !== lec.id); 
          saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
          renderAll(); 
          recordChange('Ø­ÙØ°ÙØª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©: '+lecTitle); 
          sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
        } 
      };
      const editBtn = document.createElement('button'); 
      editBtn.className='small-btn admin-only';  // Ø¥Ø¶Ø§ÙØ© class Ù„Ù„Ø¥Ø®ÙØ§Ø¡
      editBtn.innerText='âœï¸'; 
      editBtn.onclick=()=>{ openEditModal(lec); };
      actions.appendChild(editBtn); 
      actions.appendChild(delBtn); 
      card.appendChild(actions);
    }
    if(isNowInLecture(lec)) card.classList.add('current');
    container.appendChild(card);
  });
}

/* Render instructors */
function getInstructorName(id){ if(!id) return null; const i = DATA.instructors.find(x=>x.id===id); return i?i.name:null; }
function renderInstructors(){ 
  const list=document.getElementById('instructorList'); 
  if(!list) return;
  list.innerHTML=''; 
  if(DATA.instructors.length===0){ 
    list.innerHTML='<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙƒØ§ØªØ±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>'; 
    return; 
  } 
  DATA.instructors.forEach(i=>{ 
    const c=document.createElement('div'); 
    c.className='card'; 
    c.innerHTML='<div style="font-weight:800">'+escapeHtml(i.name)+'</div><div class="kv">'+escapeHtml(i.title||'')+'</div>' + (i.subjects?('<div class="kv">Ø§Ù„Ù…ÙˆØ§Ø¯: '+escapeHtml(i.subjects.join(', '))+'</div>'):''); 
    list.appendChild(c); 
  }); 
}

/* Legend */
function renderLegend(){ 
  const legend=document.getElementById('legend'); 
  if(!legend) return;
  legend.innerHTML=''; 
  const titles=Array.from(new Set(DATA.lectures.map(l=>l.title).filter(Boolean))); 
  titles.forEach(t=>{ 
    const el=document.createElement('div'); 
    el.className='legend-item'; 
    const col=genColor(t); 
    el.innerHTML='<span style="display:inline-block;width:12px;height:12px;background:'+col.solid+';border-radius:4px;margin-left:8px"></span>'+escapeHtml(t); 
    legend.appendChild(el); 
  }); 
}

/* Live check (Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©) */
function isNowInLecture(lec){ 
  if(!lec) return false; 
  const cairoNow = getCairoTime();
  const todayIndex = getCairoDayIndex();
  const today = DAYS[todayIndex]; 
  if(lec.day !== today) return false; 
  const start=new Date(cairoNow); 
  start.setHours(lec.startHour, lec.startMin||0,0,0); 
  const end=new Date(cairoNow); 
  end.setHours(lec.endHour, lec.endMin||0,0,0); 
  return cairoNow>=start && cairoNow<end; 
}

/* Ø¯Ø§Ù„Ø© timeRemaining (Ù„Ù„Ø¹Ø¯Ø§Ø¯ â€“ Ù…Ø­Ø³Ù†Ø© Ù„Ù„ÙŠÙˆÙ…/Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©/Ø«Ø§Ù†ÙŠØ©) */
function timeRemaining(targetDate){ 
  const cairoNow = getCairoTime();
  const diff = Math.max(0, targetDate - cairoNow); 
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((diff % (1000 * 60)) / 1000);
  let timeStr = '';
  if (days > 0) timeStr += days + ' ÙŠÙˆÙ… ';
  if (hours > 0) timeStr += hours + ' Ø³Ø§Ø¹Ø© ';
  if (minutes > 0 || (hours === 0 && days === 0)) timeStr += minutes + ' Ø¯Ù‚ÙŠÙ‚Ø© ';
  if (seconds > 0 || timeStr === '') timeStr += seconds + ' Ø«Ø§Ù†ÙŠØ©';
  return timeStr.trim();
}

/* Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©) */
function renderLiveNotice() {
  const noticeEl = document.getElementById('liveNotice');
  if (!noticeEl) return;
  
  const cairoNow = getCairoTime();
  const todayIndex = getCairoDayIndex();
  const today = DAYS[todayIndex];
  const todayLectures = DATA.lectures.filter(l => l.day === today);
  
  if (todayLectures.length === 0) {
    noticeEl.innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…';
    noticeEl.classList.remove('live-countdown', 'upcoming-soon', 'current');
    return;
  }
  
  const currentLecture = todayLectures.find(l => isNowInLecture(l));
  if (currentLecture) {
    noticeEl.innerText = `Ø§Ù„Ø¢Ù†: ${currentLecture.title}`;
    noticeEl.classList.add('current');
    noticeEl.classList.remove('live-countdown', 'upcoming-soon');
  } else {
    // Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„ÙŠÙˆÙ…
    const nextLecture = todayLectures.find(l => {
      const lecDate = new Date(cairoNow);
      lecDate.setHours(l.startHour, l.startMin || 0, 0, 0);
      return lecDate > cairoNow;
    });
    if (nextLecture) {
      const lecDate = new Date(cairoNow);
      lecDate.setHours(nextLecture.startHour, nextLecture.startMin || 0, 0, 0);
      noticeEl.innerText = `${nextLecture.title}: Ø¨Ø¹Ø¯ ${timeRemaining(lecDate)}`;
      noticeEl.classList.add('live-countdown');
      const diff = lecDate - cairoNow;
      if (diff < 300000) {  // Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚
        noticeEl.classList.add('upcoming-soon');
      } else {
        noticeEl.classList.remove('upcoming-soon');
      }
    } else {
      noticeEl.innerText = 'Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…';
      noticeEl.classList.remove('live-countdown', 'upcoming-soon', 'current');
    }
  }
}

/* Admin UI (Ù…Ø¹ Ø£Ù…Ø§Ù† Ù…Ø­Ø³Ù† + Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸) */
function openAdminFlow(){ 
  const root=document.getElementById('modalRoot'); 
  if(!root) return;
  root.innerHTML=''; 
  const wrap=document.createElement('div'); 
  wrap.className='modal-back'; 
  const m=document.createElement('div'); 
  m.className='modal'; 
  m.innerHTML='<h3>Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><p class="kv">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·)</p><input id="pw" class="input" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø³Ø±ÙŠØ©" /><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button id="cancelPw" class="btn">Ø¥Ù„ØºØ§Ø¡</button><button id="submitPw" class="btn">Ø¯Ø®ÙˆÙ„</button></div>'; 
  wrap.appendChild(m); 
  root.appendChild(wrap); 
  root.style.display='block'; 
  document.getElementById('cancelPw').onclick=()=>{ 
    root.style.display='none'; 
    root.innerHTML=''; 
  }; 
  document.getElementById('submitPw').onclick=()=>{ 
    const v=document.getElementById('pw').value; 
    if(v===ADMIN_PASSWORD){ 
      window.isAdmin = true; 
      root.style.display='none'; 
      root.innerHTML=''; 
      openAdmin(); updateAdminVisibility(); 
      recordChange('Ø§Ù„Ø£Ø¯Ù…Ù† Ø¯Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…'); 
      console.log('Admin login successful'); // log Ù„Ù„Ø£Ù…Ø§Ù†
    } else { 
      const pwEl=document.getElementById('pw'); 
      pwEl.style.animation='shake 0.3s'; 
      setTimeout(()=> pwEl.style.animation='',350); 
      alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ø­Ø¸ÙˆØ±.'); 
      console.log('Failed admin login attempt'); // log Ù„Ù„Ø£Ù…Ø§Ù†
    } 
  }; 
}

// Admin panel (Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸)
function openAdmin(){ 
  const root=document.getElementById('modalRoot'); 
  if(!root) return;
  root.innerHTML=''; 
  const wrap=document.createElement('div'); 
  wrap.className='modal-back'; 
  const m=document.createElement('div'); 
  m.className='modal'; 
  m.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><div><button id="saveBtn" class="btn">Ø­ÙØ¸ (ÙŠØ±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø±)</button> <button id="closeBtn" class="btn">Ø®Ø±ÙˆØ¬</button></div></div><p class="kv">Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­Ù ÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ. Ù„Ø¬Ø¹Ù„Ù‡Ø§ ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… "ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub" ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±ØŒ Ø«Ù… Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ„ØµÙ‚Ù‡ ÙÙŠ Ù…Ù„Ù HTML Ø¹Ù„Ù‰ GitHub ÙˆØ§Ø±ÙØ¹.</p><div style="margin-top:12px"><div style="display:flex;gap:8px;margin-bottom:8px"><button id="tabLect" class="btn active">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</button><button id="tabInst" class="btn">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button><button id="tabImp" class="btn">Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±</button></div><div id="adminBody"></div></div>'; 
  wrap.appendChild(m); 
  root.appendChild(wrap); 
  root.style.display='block'; 
  document.getElementById('closeBtn').onclick=()=>{ 
    window.isAdmin = false; 
    root.style.display='none'; 
    root.innerHTML=''; 
    updateAdminVisibility(); 
  }; 
  document.getElementById('saveBtn').onclick=()=>{ 
    saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø©
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.'); 
    renderAll(); 
  }; 
  // ØªØµØ­ÙŠØ­: Ø§Ø³ØªØ®Ø¯Ù… functions Ù…Ù†ÙØµÙ„Ø© Ù„Ù„Ù€ onclick Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡
  function switchToLect() { 
    document.querySelectorAll('[id^="tab"]').forEach(b=>b.classList.remove('active')); 
    document.getElementById('tabLect').classList.add('active'); 
    renderAdminLectures(); 
  }
  function switchToInst() { 
    document.querySelectorAll('[id^="tab"]').forEach(b=>b.classList.remove('active')); 
    document.getElementById('tabInst').classList.add('active'); 
    renderAdminInstructors(); 
  }
  function switchToImp() { 
    document.querySelectorAll('[id^="tab"]').forEach(b=>b.classList.remove('active')); 
    document.getElementById('tabImp').classList.add('active'); 
    renderAdminImportExport(); 
  }
  document.getElementById('tabLect').onclick = switchToLect;
  document.getElementById('tabInst').onclick = switchToInst;
  document.getElementById('tabImp').onclick = switchToImp;
  loadDataFromLocal(); // Ø­Ù…Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
  renderAdminLectures(); // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
}

function renderAdminLectures(){ 
  const body=document.getElementById('adminBody'); 
  if(!body) return;
  body.innerHTML='<div style="margin-bottom:12px"><h4>Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4></div>'; 
  const form=document.createElement('form'); 
  const hourOptions=HOURS.map(h=>'<option value="'+h+'">'+to12(h)+'</option>').join(''); 
  const minuteOptions='<option value="0">00</option><option value="30">30</option>'; 
  const instOptions='<option value="">Ø§Ø®ØªØ± Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>'+DATA.instructors.map(i=>'<option value="'+i.id+'">'+escapeHtml(i.name)+'</option>').join(''); 
  form.innerHTML='<div class="row"><div class="col"><label class="kv">Ø§Ù„ÙŠÙˆÙ…</label><select id="fDay" class="input">'+DAYS.map(d=>'<option value="'+d+'">'+d+'</option>').join('')+'</select></div><div class="col"><label class="kv">Ø¨Ø¯Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="fStartH" class="input">'+hourOptions+'</select><select id="fStartM" class="input">'+minuteOptions+'</select></div></div></div><div class="row" style="margin-top:8px"><div class="col"><label class="kv">Ù†Ù‡Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="fEndH" class="input">'+hourOptions+'</select><select id="fEndM" class="input">'+minuteOptions+'</select></div></div><div class="col"><label class="kv">Ø§Ù„Ù…Ø§Ø¯Ø©</label><input id="fTitle" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" required /></div></div><div style="margin-top:8px" class="row"><div class="col"><label class="kv">Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><select id="fInst" class="input">'+instOptions+'</select></div><div class="col"><label class="kv">Ø§Ù„Ù…ÙƒØ§Ù† Ø£Ùˆ Ø±Ø§Ø¨Ø·</label><input id="fLocation" class="input" placeholder="Ø§Ù„Ù…ÙƒØ§Ù† (Ù‚Ø§Ø¹Ø©) Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" /></div></div><textarea id="fNotes" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Ø£Ø¶Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button></div>'; 
  body.appendChild(form); 
  form.onsubmit=(e)=>{ 
    e.preventDefault(); 
    const day=document.getElementById('fDay').value; 
    const sh=+document.getElementById('fStartH').value; 
    const sm=+document.getElementById('fStartM').value; 
    const eh=+document.getElementById('fEndH').value; 
    const em=+document.getElementById('fEndM').value; 
    let startNum=sh + (sm/60); 
    let endNum=eh + (em/60); 
    if(endNum<=startNum) { 
      alert('ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©'); 
      return; 
    } 
    const startHour=Math.floor(startNum); 
    const endHour=Math.floor(endNum); 
    const lec={ 
      id: uid(), 
      day, 
      startHour, 
      startMin: sm, 
      endHour, 
      endMin: em, 
      title: document.getElementById('fTitle').value.trim(), 
      instructorId: document.getElementById('fInst').value || null, 
      instructorName: null, 
      location: document.getElementById('fLocation').value.trim(), 
      notes: document.getElementById('fNotes').value.trim(), 
      link: '' 
    }; 
    DATA.lectures.push(lec); 
    saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    recordChange('Ø£ÙØ¶ÙŠÙØª Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©: ' + lec.title); 
    renderAdminLectures(); 
    renderAll(); 
    sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    alert('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.'); 
  }; 
  const list=document.createElement('div'); 
  list.style.marginTop='12px'; 
  if(DATA.lectures.length===0) { 
    list.innerHTML='<div class="card">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ø¹Ø¯</div>'; 
  } else { 
    const ul=document.createElement('div'); 
    ul.style.display='grid'; 
    ul.style.gap='8px'; 
    DATA.lectures.forEach(l=>{ 
      const el=document.createElement('div'); 
      el.className='card'; 
      const instName=getInstructorName(l.instructorId) || l.instructorName || ''; 
      el.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">'+escapeHtml(l.title)+'</div><div class="kv">'+escapeHtml(l.day)+' '+to12WithMin(l.startHour,l.startMin)+' â€” '+to12WithMin(l.endHour,l.endMin)+' â€¢ '+escapeHtml(instName)+'</div></div><div><button class="btn small admin-only" data-id="'+l.id+'">Ø­Ø°Ù</button> <button class="btn small admin-only" data-edit="'+l.id+'">ØªØ¹Ø¯ÙŠÙ„</button></div></div>'; 
      ul.appendChild(el); 
    }); 
    list.appendChild(ul); 
    // delete buttons
    list.querySelectorAll('button[data-id]').forEach(b=> b.addEventListener('click', ()=>{ 
      const id=b.getAttribute('data-id'); 
      if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')){ 
        const lecTitle = DATA.lectures.find(x=>x.id===id)?.title || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'; 
        DATA.lectures = DATA.lectures.filter(x=> x.id !== id); 
        saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
        renderAdminLectures(); 
        renderAll(); 
        recordChange('Ø­ÙØ°ÙØª Ù…Ø­Ø§Ø¶Ø±Ø©: ' + lecTitle); 
        sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
        alert('ØªÙ… Ø§Ù„Ø­Ø°Ù ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.'); 
      } 
    })); 
    // edit buttons
    list.querySelectorAll('button[data-edit]').forEach(b=> b.addEventListener('click', ()=>{ 
      const id=b.getAttribute('data-edit'); 
      const lec = DATA.lectures.find(x=>x.id===id); 
      if(lec) openEditModal(lec); 
    })); 
  } 
  body.appendChild(list); 
}

function renderAdminInstructors(){ 
  const body=document.getElementById('adminBody'); 
  if(!body) return;
  body.innerHTML='<div style="margin-bottom:12px"><h4>Ø¥Ø¶Ø§ÙØ© Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯</h4></div>'; 
  const form=document.createElement('form'); 
  form.innerHTML='<div class="row"><div class="col"><input id="iName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±" required /></div><div class="col"><input id="iTitle" class="input" placeholder="Ø§Ù„ØªØ®ØµØµ/Ø§Ù„Ù…Ø³Ù…Ù‰" /></div></div><input id="iSubjects" class="input" placeholder="Ø§Ù„Ù…ÙˆØ§Ø¯ (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)" /><textarea id="iBio" class="input" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±"></textarea><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Ø£Ø¶Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±</button></div>'; 
  body.appendChild(form); 
  form.onsubmit=(e)=>{ 
    e.preventDefault(); 
    const inst={ 
      id: uid(), 
      name: document.getElementById('iName').value.trim(), 
      title: document.getElementById('iTitle').value.trim(), 
      subjects: document.getElementById('iSubjects').value.split(',').map(s=>s.trim()).filter(Boolean), 
      bio: document.getElementById('iBio').value.trim() 
    }; 
    if(!inst.name){ alert('Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ø·Ù„ÙˆØ¨'); return; } 
    DATA.instructors.push(inst); 
    saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    recordChange('Ø£ÙØ¶ÙŠÙ Ø¯ÙƒØªÙˆØ± Ø¬Ø¯ÙŠØ¯: ' + inst.name); 
    renderAdminInstructors(); 
    renderAll(); 
    sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
    alert('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.'); 
  }; 
  const list=document.createElement('div'); 
  list.style.marginTop='12px'; 
  if(DATA.instructors.length===0) { 
    list.innerHTML='<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙƒØ§ØªØ±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>'; 
  } else { 
    const ul=document.createElement('div'); 
    ul.style.display='grid'; 
    ul.style.gap='8px'; 
    DATA.instructors.forEach(i=>{ 
      const el=document.createElement('div'); 
      el.className='card'; 
      el.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">'+escapeHtml(i.name)+'</div><div class="kv">'+escapeHtml(i.title||'')+'</div></div><div><button class="btn small admin-only" data-id="'+i.id+'">Ø­Ø°Ù</button> <button class="btn small admin-only" data-edit="'+i.id+'">ØªØ¹Ø¯ÙŠÙ„</button></div></div>'; 
      ul.appendChild(el); 
    }); 
    list.appendChild(ul); 
    // delete buttons
    list.querySelectorAll('button[data-id]').forEach(b=> b.addEventListener('click', ()=>{ 
      const id=b.getAttribute('data-id'); 
      if(confirm('Ø­Ø°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŸ')){ 
        const instName = DATA.instructors.find(x=>x.id===id)?.name || ''; 
        DATA.instructors = DATA.instructors.filter(x=> x.id!==id); 
        saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
        renderAdminInstructors(); 
        renderAll(); 
        recordChange('Ø­ÙØ°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±: ' + instName); 
        sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
        alert('ØªÙ… Ø§Ù„Ø­Ø°Ù ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.'); 
      } 
    })); 
    // edit buttons (Ø¨Ø³ÙŠØ·Ø© â€“ ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§)
    list.querySelectorAll('button[data-edit]').forEach(b=> b.addEventListener('click', ()=>{ 
      const id=b.getAttribute('data-edit'); 
      const inst = DATA.instructors.find(x=>x.id===id); 
      if(inst) {
        // modal Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ (ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡)
        const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯:', inst.name);
        if (newName && newName.trim() !== inst.name) {
          inst.name = newName.trim();
          saveDataToLocal();
          renderAll();
          recordChange('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙƒØªÙˆØ±: ' + inst.name);
          sendNotification();
          alert('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„!');
        }
      }
    })); 
  } 
  body.appendChild(list); 
}

function renderAdminImportExport(){ 
  const body=document.getElementById('adminBody'); 
  if(!body) return;
  body.innerHTML='<div style="margin-bottom:12px"><h4>Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆÙ†Ø´Ø±</h4><p class="kv">Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… "Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ GitHub" Ù„Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§Ù‡Ø²ØŒ Ø«Ù… Ù„ØµÙ‚Ù‡ ÙÙŠ Ù…Ù„Ù HTML Ø¹Ù„Ù‰ GitHub ÙˆØ§Ø±ÙØ¹.</p></div>'; 
  const exportJsonBtn=document.createElement('button'); 
  exportJsonBtn.className='btn'; 
  exportJsonBtn.innerText='ØªØ­Ù…ÙŠÙ„ JSON'; 
  exportJsonBtn.onclick=()=>{ 
    const a=document.createElement('a'); 
    const blob=new Blob([JSON.stringify(DATA, null, 2)],{type:'application/json'}); 
    a.href=URL.createObjectURL(blob); 
    a.download='jadwal-backup.json'; 
    a.click(); 
    alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ JSON. Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯.'); 
  }; 
  const generateCodeBtn=document.createElement('button'); 
  generateCodeBtn.className='btn'; 
  generateCodeBtn.style.marginRight='8px'; 
    generateCodeBtn.innerText='Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ GitHub'; 
  generateCodeBtn.onclick=()=>{ 
    const code = `let DATA = {
  lectures: ${JSON.stringify(DATA.lectures, null, 2)},
  instructors: ${JSON.stringify(DATA.instructors, null, 2)},
  changes: []
};`;
    navigator.clipboard.writeText(code).then(() => {
      alert('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ DATA Ø§Ù„Ø¬Ø§Ù‡Ø²! Ù„ØµÙ‚Ù‡ ÙÙŠ Ù…Ù„Ù HTML ØªØ­Øª /* Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø«Ø§Ø¨ØªØ© */ØŒ Ø«Ù… Ø§Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub Ù„ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹.');
    }).catch(() => {
      // fallback Ø¥Ø°Ø§ Ù…Ø´ Ø¨ÙŠØ´ØªØºÙ„ clipboard
      const ta = document.createElement('textarea');
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ DATA! Ù„ØµÙ‚Ù‡ ÙÙŠ Ù…Ù„Ù HTMLØŒ Ø«Ù… Ø§Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub.');
    });
  }; 
  const importBtn=document.createElement('button'); 
  importBtn.className='btn'; 
  importBtn.style.marginRight='8px'; 
  importBtn.innerText='Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON'; 
  importBtn.onclick=()=>{ 
    const inp=document.createElement('input'); 
    inp.type='file'; 
    inp.accept='application/json'; 
    inp.onchange=()=>{ 
      const f=inp.files[0]; 
      if(!f) return; 
      const reader=new FileReader(); 
      reader.onload=()=>{ 
        try{ 
          const newData = JSON.parse(reader.result); 
          if(newData.lectures && newData.instructors){ 
            DATA = newData; 
            saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            renderAll(); 
            sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
            alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ GitHub.'); 
          } else { 
            alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); 
          } 
        }catch(e){ 
          alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­: ' + e.message); 
        } 
      }; 
      reader.readAsText(f); 
    }; 
    inp.click(); 
  }; 
  const clearBtn=document.createElement('button'); 
  clearBtn.className='btn'; 
  clearBtn.style.background='red'; 
  clearBtn.style.color='white'; 
  clearBtn.innerText='Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'; 
  clearBtn.onclick=()=>{ 
    if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆØ§Ù„Ø¯ÙƒØ§ØªØ±Ø©!')){ 
      DATA = {lectures:[], instructors:[], changes:[]}; 
      saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
      renderAll(); 
      recordChange('ØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); 
      sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
      alert('ØªÙ… Ø§Ù„Ù…Ø³Ø­ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ GitHub.'); 
    } 
  }; 
  body.appendChild(generateCodeBtn); 
  body.appendChild(importBtn); 
  body.appendChild(exportJsonBtn); 
  body.appendChild(clearBtn); 
}

/* Edit Modal (Ù…ØµØ­Ø­Ø© Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­ endMinuteOptions) */
function openEditModal(lec){
  const root=document.getElementById('modalRoot'); 
  if(!root) return; 
  root.innerHTML='';
  const wrap=document.createElement('div'); 
  wrap.className='modal-back'; 
  const m=document.createElement('div'); 
  m.className='modal';
  const hourOptions=HOURS.map(h=>'<option '+(h===lec.startHour?'selected':'')+' value="'+h+'">'+to12(h)+'</option>').join('');
  const minuteOptions='<option '+( (lec.startMin||0)===0 ? 'selected' : '' )+' value="0">00</option><option '+( (lec.startMin||0)===30 ? 'selected' : '' )+' value="30">30</option>';
  m.innerHTML = '<h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h3>';
  m.innerHTML += '<div class="row"><div class="col"><label class="kv">Ø§Ù„ÙŠÙˆÙ…</label><select id="eDay" class="input">'+DAYS.map(d=>'<option '+(d===lec.day?'selected':'')+' value="'+d+'">'+d+'</option>').join('')+'</select></div><div class="col"><label class="kv">Ø¨Ø¯Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="eStartH" class="input">'+hourOptions+'</select><select id="eStartM" class="input">'+minuteOptions+'</select></div></div></div>';
  // Ø¥ØµÙ„Ø§Ø­: endMinuteOptions ØµØ­ÙŠØ­Ø© Ø§Ù„Ø¢Ù†
  const endMinuteOptions='<option '+( (lec.endMin||0)===0 ? 'selected' : '' )+' value="0">00</option><option '+( (lec.endMin||0)===30 ? 'selected' : '' )+' value="30">30</option>';
  const endHourOptions=HOURS.map(h=>'<option '+(h===lec.endHour?'selected':'')+' value="'+h+'">'+to12(h)+'</option>').join('');
  m.innerHTML += '<div class="row" style="margin-top:8px"><div class="col"><label class="kv">Ù†Ù‡Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="eEndH" class="input">'+endHourOptions+'</select><select id="eEndM" class="input">'+endMinuteOptions+'</select></div></div><div class="col"><label class="kv">Ø§Ù„Ù…Ø§Ø¯Ø©</label><input id="eTitle" class="input" value="'+escapeHtml(lec.title||'')+'" /></div></div>'; 
  m.innerHTML += '<div style="margin-top:8px" class="row"><div class="col"><label class="kv">Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><select id="eInst" class="input"><option value="">Ø§Ø®ØªØ± Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>'+ (DATA.instructors.map(i=>'<option '+(i.id===lec.instructorId?'selected':'')+' value="'+i.id+'">'+escapeHtml(i.name)+'</option>').join('')) + '</select></div><div class="col"><label class="kv">Ø§Ù„Ù…ÙƒØ§Ù† Ø£Ùˆ Ø±Ø§Ø¨Ø·</label><input id="eLocation" class="input" value="'+escapeHtml(lec.location||'')+'" /></div></div>'; 
  m.innerHTML += '<textarea id="eNotes" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">'+escapeHtml(lec.notes||'')+'</textarea><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button id="cancelEdit" class="btn">Ø¥Ù„ØºØ§Ø¡</button><button id="saveEdit" class="btn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button></div>'; 
  wrap.appendChild(m); 
  root.appendChild(wrap); 
  root.style.display='block';
  document.getElementById('cancelEdit').onclick=()=>{ 
    root.style.display='none'; 
    root.innerHTML=''; 
  };
  document.getElementById('saveEdit').onclick=()=>{
    const day=document.getElementById('eDay').value;
    const sh=+document.getElementById('eStartH').value; 
    const sm=+document.getElementById('eStartM').value;
    const eh=+document.getElementById('eEndH').value; 
    const em=+document.getElementById('eEndM').value;
    const title=document.getElementById('eTitle').value.trim();
    const inst=document.getElementById('eInst').value || null;
    const loc=document.getElementById('eLocation').value.trim();
    const notes=document.getElementById('eNotes').value.trim();
    let startNum=sh + (sm/60); 
    let endNum=eh + (em/60); 
    if(endNum<=startNum) { 
      alert('ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©'); 
      return; 
    } 
    const startHour=Math.floor(startNum); 
    const endHour=Math.floor(endNum); 
    const idx = DATA.lectures.findIndex(x=> x.id===lec.id);
    if(idx>-1){
      DATA.lectures[idx].day = day;
      DATA.lectures[idx].startHour = startHour; 
      DATA.lectures[idx].startMin = sm;
      DATA.lectures[idx].endHour = endHour; 
      DATA.lectures[idx].endMin = em;
      DATA.lectures[idx].title = title;
      DATA.lectures[idx].instructorId = inst;
      DATA.lectures[idx].location = loc;
      DATA.lectures[idx].notes = notes;
      saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
      recordChange('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©: ' + title);
      renderAll();
      sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      alert('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªØµØ¯ÙŠØ± ÙƒÙˆØ¯ GitHub.');
    }
    root.style.display='none'; 
    root.innerHTML='';
  };
}

/* Change log (Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§) */
function recordChange(msg){
  try{
    const now = new Date();
    DATA.changes = DATA.changes || [];
    DATA.changes.unshift({ts: now.toISOString(), msg: msg});
    if(DATA.changes.length>300) DATA.changes.length = 300;
    saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    renderChangeLog();
  }catch(e){ console.error('recordChange error:', e); }
}

function renderChangeLog(){
  try{
    const footer = document.querySelector('.footer'); 
    if(!footer) return;
    let wrap = document.getElementById('changeLogWrap');
    if(!wrap){
      wrap = document.createElement('div'); 
      wrap.id='changeLogWrap'; 
      wrap.className='card'; 
      wrap.style.marginTop='12px'; 
      footer.parentNode.insertBefore(wrap, footer); 
    }
    const groups = {};
    (DATA.changes||[]).forEach(ch=>{ 
      const d = (ch.ts||'').slice(0,10) || 'unknown'; 
      groups[d] = groups[d] || []; 
      groups[d].push(ch); 
    });
    let html = '<h4>Ø³Ø¬Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</h4><p class="kv">Ø§Ù„Ø³Ø¬Ù„ Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</p>';
    if(Object.keys(groups).length===0) { 
      html += '<div class="kv">Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯</div>'; 
    } else {
      Object.keys(groups).sort((a,b)=> b.localeCompare(a)).forEach(date=>{
        html += '<div style="margin-top:8px"><div style="font-weight:800">'+date+'</div><ul style="margin:6px 0 0 16px">';
        groups[date].forEach(g=>{ 
          const time = (g.ts||'').slice(11,19); 
          html += '<li class="kv">'+time+' â€” '+escapeHtml(g.msg)+'</li>'; 
        });
        html += '</ul></div>';
      });
    }
    wrap.innerHTML = html;
  }catch(e){ console.error('renderChangeLog error:', e); }
}

function updateAdminVisibility(){
  // Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ù…Ø­Ø³Ù†Ø© Ù„ØªØ´Ù…Ù„ .admin-only)
  const adminElements = document.querySelectorAll('.admin-only');
  adminElements.forEach(el => el.style.display = window.isAdmin ? 'inline-block' : 'none');
}

/* Export/Import/Print handlers (Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ + ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±) */
function initHandlers(){
  // Export (Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯)
  const exportBtn = document.getElementById('exportBtn');
  if(exportBtn) exportBtn.addEventListener('click', ()=>{ 
    const a=document.createElement('a'); 
    const blob=new Blob([JSON.stringify(DATA, null, 2)],{type:'application/json'}); 
    a.href=URL.createObjectURL(blob); 
    a.download='jadwal-backup.json'; 
    a.click(); 
    alert('Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ DATA ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ØŒ Ø«Ù… Ø§Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub Ù„Ù„Ù€ sharing.'); 
  });

  // Import (Ù…Ø­Ù„ÙŠ)
  const importBtn = document.getElementById('importBtn');
  if(importBtn) importBtn.addEventListener('click', ()=>{ 
    const inp=document.createElement('input'); 
    inp.type='file'; 
    inp.accept='application/json'; 
    inp.onchange=()=>{ 
      const f=inp.files[0]; 
      if(!f) return; 
      const reader=new FileReader(); 
      reader.onload=()=>{ 
        try{ 
          const newData = JSON.parse(reader.result); 
          if(newData.lectures && newData.instructors){ 
            DATA = newData; 
            saveDataToLocal(); // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            renderAll(); 
            sendNotification();  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
            alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±. Ù„Ù„Ù€ sharingØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© > Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± > Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ GitHub.'); 
          } else { 
            alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); 
          } 
        }catch(e){ 
          alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­: ' + e.message); 
        } 
      }; 
      reader.readAsText(f); 
    }; 
    inp.click(); 
  });

  // Print (Ù…Ø¹ styles Ù…Ø­Ø³Ù†Ø©)
  const printBtn = document.getElementById('printBtn');
  if(printBtn) printBtn.addEventListener('click', ()=>{ 
    const w=window.open('','_blank'); 
    const printStyles = `
      body { font-family: 'Cairo', Arial, sans-serif; direction: rtl; padding: 16px; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
      th { background: #f0f0f0; }
      .slot { padding: 4px; border-radius: 4px; margin: 2px; }
      .current { outline: 2px solid #7c3aed; }
      .live-countdown { font-weight: bold; color: #dc3545; }  /* Ø³ØªØ§ÙŠÙ„ Ù„Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    `;
    w.document.open(); 
    w.document.write('<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title><style>'+printStyles+'</style><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"></head><body><h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>'+document.getElementById('tableContainer').innerHTML+'<p style="margin-top:20px">ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni ğŸ’»</p></body></html>'); 
    w.document.close(); 
    setTimeout(()=>{ w.print(); }, 500); 
  });

  // Admin (Ù…Ø¹ Ø£Ù…Ø§Ù†)
  const adminBtn = document.getElementById('adminBtn');
  if(adminBtn) adminBtn.addEventListener('click', openAdminFlow);

  // Theme toggle (Ù…Ø­Ù„ÙŠ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…)
  const themeToggle = document.getElementById('themeToggle');
  if(themeToggle) themeToggle.addEventListener('click', ()=>{ 
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    saveTheme(newTheme);
  });

  // Load theme
  const savedTheme = loadTheme();
  if(savedTheme === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
}

/* Tab switching */
function initTabs(){
  document.querySelectorAll('.tab-btn').forEach(b=> b.addEventListener('click', ()=>{ 
    document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active')); 
    b.classList.add('active'); 
    const tab=b.getAttribute('data-tab'); 
    document.getElementById('tab-weekly').style.display = tab==='weekly' ? 'block' : 'none'; 
    document.getElementById('tab-day').style.display = tab==='day' ? 'block' : 'none'; 
    document.getElementById('tab-instructors').style.display = tab==='instructors' ? 'block' : 'none'; 
  }));
}

function renderAll(){
  renderTable();
  renderDaysTabs();
  renderInstructors();
  renderLiveNotice();
  renderChangeLog();
  updateAdminVisibility();
  // Ø¥ØµÙ„Ø§Ø­: Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± (ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©) â€“ Ø§Ù„Ø´Ø±Ø· ØµØ­ÙŠØ­ Ø§Ù„Ø¢Ù†
  if (typeof noticeInterval === 'undefined') {
    noticeInterval = setInterval(() => {
      renderLiveNotice();  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·
    }, 60000);  // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  }
}

// Initialization
document.addEventListener('DOMContentLoaded', ()=>{ 
  loadDataFromLocal(); // Ø­Ù…Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
  initHandlers(); 
  initTabs(); 
  renderAll(); 
  // Ø­Ø¯Ø« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  if (typeof noticeInterval === 'undefined') {
    noticeInterval = setInterval(() => {
      renderLiveNotice();  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·
    }, 60000);  // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  }
  // Ù„Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ (Ø«ÙˆØ§Ù†ÙŠ) ÙÙŠ upcoming lecturesØŒ Ø­Ø¯Ø« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
  if (typeof countdownInterval === 'undefined') {
    countdownInterval = setInterval(() => {
      const noticeEl = document.getElementById('liveNotice');
      if (noticeEl && noticeEl.classList.contains('live-countdown')) {
        renderLiveNotice();  // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
      }
    }, 1000);  // ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
  }
  // ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø¥Ø°Ø§ ÙƒØ§Ù† permission granted)
  if (messaging && Notification.permission === 'granted') {
    requestPermission();  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  }
});

// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ intervals Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø£Ø¯Ø§Ø¡)
window.addEventListener('beforeunload', () => {
  if (typeof noticeInterval !== 'undefined') clearInterval(noticeInterval);
  if (typeof countdownInterval !== 'undefined') clearInterval(countdownInterval);
});
</script>
</body>
</html>
