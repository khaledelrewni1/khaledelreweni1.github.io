<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
<link rel="icon" href="icons/favicon.png">
<style>
:root{
  --accent1:#60a5fa; --accent2:#7c3aed;
  --bg-grad: linear-gradient(90deg,var(--accent1),var(--accent2));
  --card:#ffffff; --text:#071127; --muted:#475569;
  --cell-border: rgba(2,6,23,0.06);
}
[data-theme="dark"]{
  --card:#071127; --text:#e6eef8; --muted:#9ca3af; --cell-border: rgba(255,255,255,0.06);
  --bg-grad: linear-gradient(90deg,#0f172a,#0b1220);
}
*{box-sizing:border-box}
body{margin:0;font-family:'Cairo',sans-serif;background:var(--bg-grad);color:var(--text);min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:18px}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;color:white}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:52px;height:52px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-size:28px}
.title{font-size:20px;font-weight:800}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:white;color:#3730a3;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
.small-btn{background:transparent;border:1px solid rgba(255,255,255,0.18);color:white;padding:6px 10px;border-radius:8px;cursor:pointer}
.info-badge{background:rgba(255,255,255,0.16);padding:6px 10px;border-radius:8px;font-size:13px}
.nav{display:flex;gap:8px;margin:12px 0}
.tab-btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;background:rgba(255,255,255,0.12);color:white;font-weight:700}
.tab-btn.active{background:white;color:#3730a3}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(2,6,23,0.12);color:var(--text)}
.table-wrap{overflow:auto}
.table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden}
.table th, .table td{border:1px solid var(--cell-border);padding:10px;text-align:center;font-size:14px}
.table th{background:rgba(0,0,0,0.03);font-weight:800}
.slot{padding:6px;border-radius:6px}
.slot .meta{font-size:12px;color:var(--muted);margin-top:6px}
.empty{opacity:0.45}
.current{outline:3px solid rgba(124,58,237,0.18);box-shadow:0 6px 18px rgba(124,58,237,0.08)}
.legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.legend-item{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.06);font-size:13px}
.footer{padding:12px;text-align:center;color:rgba(255,255,255,0.9);opacity:0.9;margin-top:12px}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:9999}
.modal{width:100%;max-width:900px;background:var(--card);border-radius:12px;padding:16px;color:var(--text);max-height:90vh;overflow:auto}
.input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:6px}
.row{display:flex;gap:8px}
.col{flex:1}
.kv{font-size:13px;color:var(--muted)}
.top-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.days-tabs{display:flex;gap:6px;flex-wrap:wrap}
.day-tab{padding:6px 10px;border-radius:8px;border:none;cursor:pointer;background:rgba(15,23,42,0.03)}
.day-tab.active{background:var(--accent2);color:white}
@media (max-width:900px){
  .header-row{flex-direction:column;align-items:flex-start}
  .row{flex-direction:column}
  .table th, .table td{font-size:12px;padding:8px}
}
.notice-small{font-size:13px;color:rgba(255,255,255,0.9);opacity:0.95;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <div class="header-row">
    <div class="brand">
      <div class="logo">ğŸ“˜</div>
      <div>
        <div class="title">ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
        <div class="notice-small">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹</div>
      </div>
    </div>
    <div class="controls">
      <div id="liveNotice" class="info-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø¢Ù†</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="exportBtn" class="small-btn" title="ØªØµØ¯ÙŠØ± JSON">ØªØµØ¯ÙŠØ±</button>
        <button id="importBtn" class="small-btn" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        <button id="printBtn" class="small-btn" title="ØªØ­Ù…ÙŠÙ„ PDF">ØªØ­Ù…ÙŠÙ„ PDF</button>
        <button id="adminBtn" class="btn" title="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        <button id="themeToggle" class="small-btn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">Ø§Ù„ÙˆØ¶Ø¹</button>
      </div>
    </div>
  </div>

  <nav class="nav">
    <button class="tab-btn active" data-tab="weekly">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
    <button class="tab-btn" data-tab="day">Ø§Ù„ÙŠÙˆÙ…</button>
    <button class="tab-btn" data-tab="instructors">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button>
  </nav>

  <main>
    <!-- Weekly Tab -->
    <section id="tab-weekly" class="card table-wrap">
      <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
      <div class="top-actions" style="margin-bottom:8px">
        <div class="kv">Ø³Ø§Ø¹Ø§Øª: 8:00 Øµ â†’ 10:00 Ù…</div>
        <div id="legend" class="legend"></div>
      </div>
      <div id="tableContainer"></div>
    </section>

    <!-- Day Tab -->
    <section id="tab-day" class="card" style="display:none;margin-top:12px">
      <h3>Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
      <div class="days-tabs" id="daysTabs"></div>
      <div id="dayContainer" style="margin-top:12px"></div>
    </section>

    <!-- Instructors Tab -->
    <section id="tab-instructors" class="card" style="display:none;margin-top:12px">
      <h3>Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</h3>
      <div id="instructorList" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px"></div>
    </section>

    <section class="card" style="margin-top:12px">
      <h4>ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni ğŸ’»</h4>
    </section>
  </main>

  <footer class="footer">Â© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</footer>
</div>

<div id="modalRoot" style="display:none"></div>

<script>
/* Config */
const ADMIN_PASSWORD = 'khaled181';
const STORAGE_KEY = 'jadwal_v3_data';
const DAYS = ['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'];
const HOURS = Array.from({length:15},(_,i)=>8+i);

/* Time helpers */
function to12(h){ const period = h>=12 ? 'Ù…' : 'Øµ'; let hh = h%12; if(hh===0) hh=12; return hh + ':00 ' + period; }
function to12WithMin(h,m){ const hour = parseInt(h,10); const period = hour>=12 ? 'Ù…' : 'Øµ'; let hh = hour%12; if(hh===0) hh=12; return hh + ':' + String(m).padStart(2,'0') + ' ' + period; }

/* Data storage */
function uid(){ return 'id'+Math.random().toString(36).slice(2,9); }
function loadData(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {lectures:[], instructors:[]}; }catch(e){ return {lectures:[], instructors:[]}; } }
function saveData(d){ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }

let DATA = loadData();

/* Helpers */
function getInstructorName(id){ if(!id) return null; const i = DATA.instructors.find(x=>x.id===id); return i?i.name:null; }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escapeAttr(s){ if(!s) return ''; return String(s).replace(/"/g,'&quot;'); }

/* Color per subject */
const colorCache={};
function genColor(title){ if(!title) return {bg:'rgba(243,244,246,0.6)',solid:'#e5e7eb'}; if(colorCache[title]) return colorCache[title]; let h=0; for(let i=0;i<title.length;i++){ h=(h<<5)-h+title.charCodeAt(i); h|=0; } const r=Math.abs(h)%200+20; const g=(Math.abs(h*13)%150)+80; const b=(Math.abs(h*7)%180)+40; const bg='rgba('+r+','+g+','+b+',0.18)'; const solid='rgba('+r+','+g+','+b+',0.95)'; colorCache[title]={bg,solid}; return colorCache[title]; }

/* Render weekly table */
function renderTable(){
  const container=document.getElementById('tableContainer'); container.innerHTML='';
  const table=document.createElement('table'); table.className='table';
  const thead=document.createElement('thead'); const headRow=document.createElement('tr'); headRow.appendChild(document.createElement('th'));
  HOURS.forEach(h=>{ const th=document.createElement('th'); th.innerText=to12(h); headRow.appendChild(th); });
  thead.appendChild(headRow); table.appendChild(thead);
  const tbody=document.createElement('tbody'); const map={};
  DATA.lectures.forEach(l=>{ if(!l.day) return; if(!map[l.day]) map[l.day]=[]; map[l.day].push(l); });
  DAYS.forEach(day=>{ const tr=document.createElement('tr'); const dayCell=document.createElement('th'); dayCell.innerText=day; tr.appendChild(dayCell);
    HOURS.forEach(h=>{ const td=document.createElement('td'); const lectures=(map[day]||[]).filter(l=>{ const start=l.startHour+(l.startMin||0)/60; const end=l.endHour+(l.endMin||0)/60; return start<=h && h<end; });
      if(lectures.length===0){ td.innerHTML='<div class="slot empty">'+h+':00 â€” ÙØ§Ø±Øº</div>'; }
      else{
        // if multiple lectures (different instructors same subject), list them stacked
        const box=document.createElement('div');
        lectures.forEach(lec=>{ const col=genColor(lec.title); const div=document.createElement('div'); div.className='slot'; div.style.background=col.bg; div.style.borderRadius='8px'; div.style.padding='6px'; div.style.marginBottom='6px'; const title=document.createElement('div'); title.style.fontWeight='800'; title.style.color=col.solid; title.innerText=lec.title; const meta=document.createElement('div'); meta.className='meta'; meta.innerText=(getInstructorName(lec.instructorId)||lec.instructorName||'') + ' â€¢ ' + (lec.location|| (lec.link? 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†':'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')); const timeEl=document.createElement('div'); timeEl.className='meta'; timeEl.innerText = to12WithMin(lec.startHour,lec.startMin||0) + ' â€” ' + to12WithMin(lec.endHour,lec.endMin||0); div.appendChild(title); div.appendChild(meta); div.appendChild(timeEl); if(lec.link){ const a=document.createElement('a'); a.href=lec.link; a.target='_blank'; a.innerText='Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'; a.style.display='block'; a.style.marginTop='6px'; div.appendChild(a); } if(isNowInLecture(lec)) div.classList.add('current'); box.appendChild(div); });
        td.appendChild(box);
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); container.appendChild(table); renderLegend();
}

/* Render day tabs and day view */
function renderDaysTabs(){
  const daysTabs=document.getElementById('daysTabs'); daysTabs.innerHTML='';
  DAYS.forEach(d=>{ const btn=document.createElement('button'); btn.className='day-tab'; btn.innerText=d; btn.onclick=()=> showDay(d); daysTabs.appendChild(btn); });
  // activate today by default
  const jsWeek=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const today=jsWeek[new Date().getDay()];
  showDay(today);
}
function showDay(day){
  // highlight selected tab
  document.querySelectorAll('.day-tab').forEach(b=> b.classList.toggle('active', b.innerText===day));
  const container=document.getElementById('dayContainer'); container.innerHTML='';
  const lectures=(DATA.lectures||[]).filter(l=> l.day===day).sort((a,b)=> (a.startHour+a.startMin/60)-(b.startHour+b.startMin/60));
  if(lectures.length===0){ container.innerHTML='<div class="card">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>'; return; }
  lectures.forEach(lec=>{
    const card=document.createElement('div'); card.className='card'; card.style.marginBottom='8px';
    const title=document.createElement('div'); title.style.fontWeight='800'; title.innerText=lec.title;
    const meta=document.createElement('div'); meta.className='kv'; meta.innerText=(getInstructorName(lec.instructorId)||lec.instructorName||'') + ' â€¢ ' + (lec.location|| (lec.link? 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†':'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'));
    const timeEl=document.createElement('div'); timeEl.className='kv'; timeEl.innerText = to12WithMin(lec.startHour,lec.startMin||0) + ' â€” ' + to12WithMin(lec.endHour,lec.endMin||0);
    card.appendChild(title); card.appendChild(meta); card.appendChild(timeEl); if(lec.link){ const a=document.createElement('a'); a.href=lec.link; a.target='_blank'; a.innerText='Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'; a.style.display='block'; a.style.marginTop='6px'; card.appendChild(a); }
    if(isNowInLecture(lec)) card.classList.add('current');
    container.appendChild(card);
  });
}

/* Render instructors */
function renderInstructors(){ const list=document.getElementById('instructorList'); list.innerHTML=''; if(DATA.instructors.length===0){ list.innerHTML='<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙƒØ§ØªØ±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>'; return; } DATA.instructors.forEach(i=>{ const c=document.createElement('div'); c.className='card'; c.innerHTML='<div style="font-weight:800">'+escapeHtml(i.name)+'</div><div class="kv">'+escapeHtml(i.title||'')+'</div>' + (i.subjects?('<div class="kv">Ø§Ù„Ù…ÙˆØ§Ø¯: '+escapeHtml(i.subjects.join(', '))+'</div>'):''); list.appendChild(c); }); }

/* Legend */
function renderLegend(){ const legend=document.getElementById('legend'); legend.innerHTML=''; const titles=Array.from(new Set(DATA.lectures.map(l=>l.title).filter(Boolean))); titles.forEach(t=>{ const el=document.createElement('div'); el.className='legend-item'; const col=genColor(t); el.innerHTML='<span style="display:inline-block;width:12px;height:12px;background:'+col.solid+';border-radius:4px;margin-left:8px"></span>'+escapeHtml(t); legend.appendChild(el); }); }

/* genColor */
function genColor(title){ if(!title) return {bg:'rgba(243,244,246,0.6)',solid:'#e5e7eb'}; if(colorCache[title]) return colorCache[title]; let h=0; for(let i=0;i<title.length;i++){ h=(h<<5)-h+title.charCodeAt(i); h|=0; } const r=Math.abs(h)%200+20; const g=(Math.abs(h*13)%150)+80; const b=(Math.abs(h*7)%180)+40; const bg='rgba('+r+','+g+','+b+',0.18)'; const solid='rgba('+r+','+g+','+b+',0.95)'; colorCache[title]={bg,solid}; return colorCache[title]; }

/* Admin UI (password -> admin panel) */
function openAdminFlow(){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const wrap=document.createElement('div'); wrap.className='modal-back'; const m=document.createElement('div'); m.className='modal'; m.innerHTML='<h3>Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><p class="kv">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p><input id="pw" class="input" type="password" /><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button id="cancelPw" class="btn">Ø¥Ù„ØºØ§Ø¡</button><button id="submitPw" class="btn">Ø¯Ø®ÙˆÙ„</button></div>'; wrap.appendChild(m); root.appendChild(wrap); root.style.display='block'; document.getElementById('cancelPw').onclick=()=>{ root.style.display='none'; root.innerHTML=''; }; document.getElementById('submitPw').onclick=()=>{ const v=document.getElementById('pw').value; if(v===ADMIN_PASSWORD){ root.style.display='none'; root.innerHTML=''; openAdmin(); } else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'); }; }

function openAdmin(){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const wrap=document.createElement('div'); wrap.className='modal-back'; const m=document.createElement('div'); m.className='modal'; m.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><div><button id="saveBtn" class="btn">Ø­ÙØ¸</button> <button id="closeBtn" class="btn">Ø®Ø±ÙˆØ¬</button></div></div><div style="margin-top:12px"><div style="display:flex;gap:8px;margin-bottom:8px"><button id="tabLect" class="btn">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</button><button id="tabInst" class="btn">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button><button id="tabImp" class="btn">Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±</button></div><div id="adminBody"></div></div>'; wrap.appendChild(m); root.appendChild(wrap); root.style.display='block'; document.getElementById('closeBtn').onclick=()=>{ root.style.display='none'; root.innerHTML=''; }; document.getElementById('saveBtn').onclick=()=>{ saveData(DATA); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); renderAll(); }; document.getElementById('tabLect').onclick=()=> renderAdminLectures(); document.getElementById('tabInst').onclick=()=> renderAdminInstructors(); document.getElementById('tabImp').onclick=()=> renderAdminImportExport(); renderAdminLectures(); }

function renderAdminLectures(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const form=document.createElement('form'); const hourOptions=HOURS.map(h=>'<option value="'+h+'">'+to12(h)+'</option>').join(''); const minuteOptions='<option value=\"0\">00</option><option value=\"30\">30</option>'; const instOptions='<option value=\"\">Ø§Ø®ØªØ± Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>'+DATA.instructors.map(i=>'<option value=\"'+i.id+'\">'+escapeHtml(i.name)+'</option>').join(''); form.innerHTML='<div class="row"><div class="col"><label class="kv">Ø§Ù„ÙŠÙˆÙ…</label><select id="fDay" class="input">'+DAYS.map(d=>'<option value="'+d+'">'+d+'</option>').join('')+'</select></div><div class="col"><label class="kv">Ø¨Ø¯Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="fStartH" class="input">'+hourOptions+'</select><select id="fStartM" class="input">'+minuteOptions+'</select></div></div></div><div class="row" style="margin-top:8px"><div class="col"><label class="kv">Ù†Ù‡Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class="row"><select id="fEndH" class="input">'+hourOptions+'</select><select id="fEndM" class="input">'+minuteOptions+'</select></div></div><div class="col"><label class="kv">Ø§Ù„Ù…Ø§Ø¯Ø©</label><input id="fTitle" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" required /></div></div><div style="margin-top:8px" class="row"><div class="col"><label class="kv">Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><select id="fInst" class="input">'+instOptions+'</select></div><div class="col"><label class="kv">Ø§Ù„Ù…ÙƒØ§Ù† Ø£Ùˆ Ø±Ø§Ø¨Ø·</label><input id="fLocation" class="input" placeholder="Ø§Ù„Ù…ÙƒØ§Ù† (Ù‚Ø§Ø¹Ø©) Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" /></div></div><textarea id="fNotes" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Ø£Ø¶Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button></div>'; body.appendChild(form); form.onsubmit=(e)=>{ e.preventDefault(); const day=document.getElementById('fDay').value; const sh=+document.getElementById('fStartH').value; const sm=+document.getElementById('fStartM').value; const eh=+document.getElementById('fEndH').value; const em=+document.getElementById('fEndM').value; let startNum=sh + (sm>0?0.5:0); let endNum=eh + (em>0?0.5:0); if(endNum<=startNum) endNum = startNum + 1; const startHour=Math.floor(startNum); const endHour=Math.ceil(endNum); const lec={ id: uid(), day, startHour, startMin: sm, endHour, endMin: em, title: document.getElementById('fTitle').value.trim(), instructorId: document.getElementById('fInst').value || null, instructorName: null, location: document.getElementById('fLocation').value.trim(), notes: document.getElementById('fNotes').value.trim(), link: '' }; DATA.lectures.push(lec); saveData(DATA); renderAdminLectures(); renderAll(); }; const list=document.createElement('div'); list.style.marginTop='12px'; if(DATA.lectures.length===0) list.innerHTML='<div class="card">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ø¹Ø¯</div>'; else{ const ul=document.createElement('div'); ul.style.display='grid'; ul.style.gap='8px'; DATA.lectures.forEach(l=>{ const el=document.createElement('div'); el.className='card'; const instName=getInstructorName(l.instructorId) || l.instructorName || ''; el.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">'+escapeHtml(l.title)+'</div><div class="kv">'+escapeHtml(l.day)+' '+to12WithMin(l.startHour,l.startMin)+' â€” '+to12WithMin(l.endHour,l.endMin)+' â€¢ '+escapeHtml(instName)+'</div></div><div><button class="btn" data-id="'+l.id+'">Ø­Ø°Ù</button></div></div>'; ul.appendChild(el); }); list.appendChild(ul); list.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=>{ const id=b.getAttribute('data-id'); if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')){ DATA.lectures = DATA.lectures.filter(x=> x.id !== id); saveData(DATA); renderAdminLectures(); renderAll(); } })); } body.appendChild(list); }

function renderAdminInstructors(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const form=document.createElement('form'); form.innerHTML='<div class="row"><div class="col"><input id="iName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±" required /></div><div class="col"><input id="iTitle" class="input" placeholder="Ø§Ù„ØªØ®ØµØµ/Ø§Ù„Ù…Ø³Ù…Ù‰" /></div></div><input id="iSubjects" class="input" placeholder="Ø§Ù„Ù…ÙˆØ§Ø¯ (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)" /><textarea id="iBio" class="input" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±"></textarea><div style="display:flex;justify-content:flex-end;margin-top:8px"><button class="btn" type="submit">Ø£Ø¶Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±</button></div>'; body.appendChild(form); form.onsubmit=(e)=>{ e.preventDefault(); const inst={ id: uid(), name: document.getElementById('iName').value.trim(), title: document.getElementById('iTitle').value.trim(), subjects: document.getElementById('iSubjects').value.split(',').map(s=>s.trim()).filter(Boolean), bio: document.getElementById('iBio').value.trim() }; DATA.instructors.push(inst); saveData(DATA); renderAdminInstructors(); renderAll(); }; const list=document.createElement('div'); list.style.marginTop='12px'; if(DATA.instructors.length===0) list.innerHTML='<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙƒØ§ØªØ±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>'; else{ const ul=document.createElement('div'); ul.style.display='grid'; ul.style.gap='8px'; DATA.instructors.forEach(i=>{ const el=document.createElement('div'); el.className='card'; el.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">'+escapeHtml(i.name)+'</div><div class="kv">'+escapeHtml(i.title||'')+'</div></div><div><button class="btn" data-id="'+i.id+'">Ø­Ø°Ù</button></div></div>'; ul.appendChild(el); }); list.appendChild(ul); list.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=>{ const id=b.getAttribute('data-id'); if(confirm('Ø­Ø°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŸ')){ DATA.instructors = DATA.instructors.filter(x=> x.id!==id); saveData(DATA); renderAdminInstructors(); renderAll(); } })); } body.appendChild(list); }

function renderAdminImportExport(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const exportBtn=document.createElement('button'); exportBtn.className='btn'; exportBtn.innerText='ØªØ­Ù…ÙŠÙ„ JSON'; exportBtn.onclick=()=>{ const a=document.createElement('a'); const blob=new Blob([JSON.stringify(DATA)],{type:'application/json'}); a.href=URL.createObjectURL(blob); a.download='jadwal-v3-backup.json'; a.click(); }; const importBtn=document.createElement('button'); importBtn.className='btn'; importBtn.style.marginLeft='8px'; importBtn.innerText='Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON'; importBtn.onclick=()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=()=>{ const f=inp.files[0]; const reader=new FileReader(); reader.onload=()=>{ try{ DATA = JSON.parse(reader.result); saveData(DATA); renderAll(); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }catch(e){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); } }; reader.readAsText(f); }; inp.click(); }; body.appendChild(exportBtn); body.appendChild(importBtn); body.appendChild(document.createElement('div')); }

/* Admin flow */
function openAdminFlowHandlers(){ document.getElementById('adminBtn').addEventListener('click', ()=> openAdminFlow()); }
document.addEventListener('DOMContentLoaded', ()=> openAdminFlowHandlers());

function openAdminFlow(){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const wrap=document.createElement('div'); wrap.className='modal-back'; const m=document.createElement('div'); m.className='modal'; m.innerHTML='<h3>Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><p class="kv">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p><input id="pw" class="input" type="password" /><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button id="cancelPw" class="btn">Ø¥Ù„ØºØ§Ø¡</button><button id="submitPw" class="btn">Ø¯Ø®ÙˆÙ„</button></div>'; wrap.appendChild(m); root.appendChild(wrap); root.style.display='block'; document.getElementById('cancelPw').onclick=()=>{ root.style.display='none'; root.innerHTML=''; }; document.getElementById('submitPw').onclick=()=>{ const v=document.getElementById('pw').value; if(v===ADMIN_PASSWORD){ root.style.display='none'; root.innerHTML=''; openAdmin(); } else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'); }; }

/* Live check */
function isNowInLecture(lec){ if(!lec) return false; const now=new Date(); const jsWeek=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const todayName=jsWeek[now.getDay()]; if(lec.day !== todayName) return false; const start=new Date(); start.setHours(lec.startHour, lec.startMin||0,0,0); const end=new Date(); end.setHours(lec.endHour, lec.endMin||0,0,0); return now>=start && now<end; }
function renderLiveNotice(){ const live=document.getElementById('liveNotice'); const now=new Date(); const jsWeek=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const todayName=jsWeek[now.getDay()]; const todays = (DATA.lectures||[]).filter(l=> l.day===todayName).map(l=>{ const s=new Date(); s.setHours(l.startHour,l.startMin||0,0,0); return {l,s}; }).sort((a,b)=> a.s-b.s); const current = (DATA.lectures||[]).find(l=> isNowInLecture(l)); if(current){ live.innerText='ğŸ•’ Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø­Ø§Ø¶Ø±Ø©: ' + current.title; return; } if(todays.length>0){ const next = todays.find(t=> t.s>now); if(next) live.innerText='â³ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ÙŠÙˆÙ…: ' + next.l.title + ' Ø¨Ø¹Ø¯ ' + timeRemaining(next.s); else live.innerText='Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ø§Ø­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…'; return; } live.innerText='Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø¢Ù†'; }

function timeRemaining(targetDate){ const diff = Math.max(0, targetDate - new Date()); const hrs = Math.floor(diff/3600000); const mins = Math.floor((diff%3600000)/60000); return (hrs>0? hrs+' Ø³Ø§Ø¹Ø© ':'') + mins + ' Ø¯Ù‚ÙŠÙ‚Ø©'; }

/* Export/Import/Print handlers */
document.getElementById('exportBtn').addEventListener('click', ()=>{ const a=document.createElement('a'); const blob=new Blob([JSON.stringify(DATA)],{type:'application/json'}); a.href=URL.createObjectURL(blob); a.download='jadwal-v3-backup.json'; a.click(); });
document.getElementById('importBtn').addEventListener('click', ()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=()=>{ const f=inp.files[0]; const reader=new FileReader(); reader.onload=()=>{ try{ DATA = JSON.parse(reader.result); saveData(DATA); renderAll(); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }catch(e){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); } }; reader.readAsText(f); }; inp.click(); });
document.getElementById('printBtn').addEventListener('click', ()=>{ const w=window.open('','_blank'); w.document.open(); w.document.write('<!doctype html><html lang=\"ar\" dir=\"rtl\"><head><meta charset=\"utf-8\"/><title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title><style>body{font-family:Arial,sans-serif;padding:16px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ccc;padding:6px;text-align:center}th{background:#f0f0f0}</style></head><body><h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>'+document.getElementById('tableContainer').innerHTML+'<p>ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni</p></body></html>'); w.document.close(); setTimeout(()=>{ w.print(); },600); });

/* Tab switching */
document.querySelectorAll('.tab-btn').forEach(b=> b.addEventListener('click', ()=>{ document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); const tab=b.getAttribute('data-tab'); document.getElementById('tab-weekly').style.display = tab==='weekly' ? 'block' : 'none'; document.getElementById('tab-day').style.display = tab==='day' ? 'block' : 'none'; document.getElementById('tab-instructors').style.display = tab==='instructors' ? 'block' : 'none'; }));

function renderAll(){ renderTable(); renderDaysTabs(); renderInstructors(); renderLiveNotice(); }
renderAll();
setInterval(()=>{ renderAll(); },60000); // refresh each minute

/* expose API */
window.jadwal_v3 = { data: ()=> JSON.stringify(DATA), clear: ()=>{ if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')){ DATA={lectures:[], instructors:[]}; saveData(DATA); renderAll(); } } };
</script>
</body>
</html>
