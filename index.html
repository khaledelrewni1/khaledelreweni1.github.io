<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
<link rel="icon" href="icons/favicon.png">
<style>
:root{
  --accent1:#60a5fa; --accent2:#7c3aed;
  --bg-grad: linear-gradient(90deg,var(--accent1),var(--accent2));
  --card:#ffffff; --text:#071127; --muted:#475569;
  --cell-border: rgba(2,6,23,0.06);
}
[data-theme="dark"]{
  --card:#071127; --text:#e6eef8; --muted:#9ca3af; --cell-border: rgba(255,255,255,0.06);
  --bg-grad: linear-gradient(90deg,#0f172a,#0b1220);
}
*{box-sizing:border-box}
body{margin:0;font-family:'Cairo',sans-serif;background:var(--bg-grad);color:var(--text);min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:18px}
.header{background:transparent;padding:8px 0;color:white}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:52px;height:52px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-size:28px}
.title{font-size:20px;font-weight:800}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:white;color:#3730a3;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
.small-btn{background:transparent;border:1px solid rgba(255,255,255,0.18);color:white;padding:6px 10px;border-radius:8px;cursor:pointer}
.info-badge{background:rgba(255,255,255,0.16);padding:6px 10px;border-radius:8px;font-size:13px}
.nav{display:flex;gap:8px;margin:12px 0}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(2,6,23,0.12);color:var(--text)}
.grid{display:grid;gap:12px}
.table-wrap{overflow:auto}
.table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden}
.table th, .table td{border:1px solid var(--cell-border);padding:10px;text-align:center;font-size:14px;}
.table th{background:rgba(0,0,0,0.03);font-weight:800}
.slot{padding:6px;border-radius:6px}
.slot .meta{font-size:12px;color:var(--muted);margin-top:6px}
.empty{opacity:0.45}
.current{outline:3px solid rgba(124,58,237,0.18);box-shadow:0 6px 18px rgba(124,58,237,0.08)}
.legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.legend-item{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.06);font-size:13px}
.footer{padding:12px;text-align:center;color:rgba(255,255,255,0.9);opacity:0.9;margin-top:12px}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;padding:16px;z-index:9999}
.modal{width:100%;max-width:900px;background:var(--card);border-radius:12px;padding:16px;color:var(--text);max-height:90vh;overflow:auto}
.input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:6px}
.row{display:flex;gap:8px}
.col{flex:1}
.kv{font-size:13px;color:var(--muted)}
.top-actions{display:flex;gap:8px;flex-wrap:wrap}
@media (max-width:900px){
  .header-row{flex-direction:column;align-items:flex-start}
  .row{flex-direction:column}
  .table th, .table td{font-size:12px;padding:8px}
}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="header-row">
      <div class="brand">
        <div class="logo">ğŸ“˜</div>
        <div>
          <div class="title">ğŸ“˜ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
        </div>
      </div>
      <div class="controls">
        <div id="liveNotice" class="info-badge">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø¢Ù†</div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="printBtn" class="small-btn" title="ØªØ­Ù…ÙŠÙ„ PDF / Ø·Ø¨Ø§Ø¹Ø©">ØªØ­Ù…ÙŠÙ„ PDF</button>
          <button id="exportBtn" class="small-btn" title="ØªØµØ¯ÙŠØ± JSON">ØªØµØ¯ÙŠØ±</button>
          <button id="importBtn" class="small-btn" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
          <button id="adminBtn" class="btn" title="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
          <button id="themeToggle" class="small-btn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">Ø§Ù„ÙˆØ¶Ø¹</button>
        </div>
      </div>
    </div>
  </header>

  <nav class="nav">
    <div class="card" style="padding:8px 12px">Ø§Ù„Ø£Ø³Ù€Ù€Ù€Ø¨ÙˆØ¹: <strong class="kv">Ø§Ù„Ø³Ø¨Øª â†’ Ø§Ù„Ø¬Ù…Ø¹Ø©</strong></div>
    <div class="card" style="padding:8px 12px">Ø§Ù„Ø³Ø§Ø¹Ø§Øª: <strong class="kv">8:00 Øµ â†’ 10:00 Ù…</strong></div>
  </nav>

  <main>
    <section class="card table-wrap">
      <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
      <div class="top-actions" style="margin-bottom:8px">
        <div class="kv">Ø¹Ø±Ø¶ Ø¨Ù†Ø¸Ø§Ù… 12 Ø³Ø§Ø¹Ø© (AM/PM)</div>
        <div id="legend" class="legend"></div>
      </div>
      <div id="tableContainer"></div>
    </section>
    <section class="card" style="margin-top:12px">
      <h4>ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni</h4>
    </section>
  </main>

  <footer class="footer">Â© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</footer>
</div>

<div id="modalRoot" style="display:none"></div>

<script>
/* Configuration */
const ADMIN_PASSWORD = 'khaled181';
const STORAGE_KEY = 'jadwal_v2_data';
const DAYS = ['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'];
const HOURS = Array.from({length:15},(_,i)=>8+i); // 8..22 inclusive

/* Time format helpers (12-hour) */
function to12(h){ const period = h>=12 ? 'Ù…' : 'Øµ'; let hh = h%12; if(hh===0) hh=12; return hh + ':00 ' + period; }
function to12WithMin(h,m){ const hour = parseInt(h,10); const period = hour>=12 ? 'Ù…' : 'Øµ'; let hh = hour%12; if(hh===0) hh=12; return hh + ':' + String(m).padStart(2,'0') + ' ' + period; }

/* Data handling */
function uid(){ return 'id'+Math.random().toString(36).slice(2,9); }
function loadData(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {lectures:[], instructors:[]}; }catch(e){ return {lectures:[], instructors:[]}; } }
function saveData(d){ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }

let DATA = loadData();

/* Helpers */
function getInstructorName(id){ if(!id) return null; const inst = DATA.instructors.find(x=>x.id===id); return inst?inst.name:null; }

/* Color per subject (solid + translucent) */
const colorCache = {};
function genColor(title){
  if(!title) return {bg:'rgba(243,244,246,0.6)', solid:'#e5e7eb'};
  if(colorCache[title]) return colorCache[title];
  let h=0; for(let i=0;i<title.length;i++){ h=(h<<5)-h+title.charCodeAt(i); h|=0; }
  const r = Math.abs(h)%200 + 20; const g = (Math.abs(h*13)%150)+80; const b = (Math.abs(h*7)%180)+40;
  const bg = 'rgba('+r+','+g+','+b+',0.18)'; const solid = 'rgba('+r+','+g+','+b+',0.95)';
  colorCache[title]={bg,solid}; return colorCache[title];
}

/* Render Table */
function renderTable(){
  const container = document.getElementById('tableContainer');
  container.innerHTML='';
  const table = document.createElement('table'); table.className='table';
  const thead = document.createElement('thead');
  const headRow = document.createElement('tr');
  headRow.appendChild(document.createElement('th'));
  HOURS.forEach(h=>{ const th=document.createElement('th'); th.innerText = to12(h); headRow.appendChild(th); });
  thead.appendChild(headRow); table.appendChild(thead);
  const tbody = document.createElement('tbody');
  const map = {};
  DATA.lectures.forEach(l=>{ if(!l.day) return; if(!map[l.day]) map[l.day]=[]; map[l.day].push(l); });
  DAYS.forEach(day=>{
    const tr = document.createElement('tr');
    const dayCell = document.createElement('th'); dayCell.innerText = day; tr.appendChild(dayCell);
    HOURS.forEach(h=>{
      const td = document.createElement('td');
      const lectures = (map[day]||[]).filter(l=> { const start = +l.startHour + ((l.startMin||0)/60); const end = +l.endHour + ((l.endMin||0)/60); return start <= h && h < end; });
      if(lectures.length===0){ td.innerHTML = '<div class="slot empty">'+h+':00 â€” ÙØ§Ø±Øº</div>'; }
      else{
        const lec = lectures[0];
        const col = genColor(lec.title);
        const title = escapeHtml(lec.title||'');
        const instName = getInstructorName(lec.instructorId) || lec.instructorName || '';
        const loc = lec.location || (lec.link? 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
        const timeText = to12WithMin(lec.startHour, lec.startMin||0) + ' â€” ' + to12WithMin(lec.endHour, lec.endMin||0);
        td.innerHTML = '<div class="slot" style="background:'+col.bg+';border-radius:8px;padding:8px"><div style="font-weight:800;color:'+col.solid+'">'+title+'</div><div class="meta">'+escapeHtml(instName)+' â€¢ '+escapeHtml(loc)+'</div><div class="meta">'+escapeHtml(timeText)+'</div>' + (lec.link?('<div style="margin-top:6px"><a href="'+escapeAttr(lec.link)+'" target="_blank">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</a></div>'):'') + '</div>';
        if(isNowInLecture(lec)) td.querySelector('.slot').classList.add('current');
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); container.appendChild(table); renderLegend();
}

/* Legend */
function renderLegend(){ const legend=document.getElementById('legend'); legend.innerHTML=''; const titles=Array.from(new Set(DATA.lectures.map(l=>l.title).filter(Boolean))); titles.forEach(t=>{ const el=document.createElement('div'); el.className='legend-item'; const col=genColor(t); el.innerHTML='<span style="display:inline-block;width:12px;height:12px;background:'+col.solid+';border-radius:4px;margin-left:8px"></span>'+escapeHtml(t); legend.appendChild(el); }); }

/* Escapes */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escapeAttr(s){ if(!s) return ''; return String(s).replace(/"/g,'&quot;'); }

/* Admin UI */
function openAdmin(){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const wrap=document.createElement('div'); wrap.className='modal-back'; const m=document.createElement('div'); m.className='modal'; m.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><div><button id="saveBtn" class="btn">Ø­ÙØ¸</button> <button id="closeBtn" class="btn">Ø®Ø±ÙˆØ¬</button></div></div><div style="margin-top:12px"><div style="display:flex;gap:8px;margin-bottom:8px"><button id="tabLect" class="btn">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</button><button id="tabInst" class="btn">Ø§Ù„Ø¯ÙƒØ§ØªØ±Ø©</button><button id="tabImp" class="btn">Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ±</button></div><div id="adminBody"></div></div>'; wrap.appendChild(m); root.appendChild(wrap); root.style.display='block'; document.getElementById('closeBtn').onclick=()=>{ root.style.display='none'; root.innerHTML=''; }; document.getElementById('saveBtn').onclick=()=>{ saveData(DATA); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); renderTable(); renderLiveNotice(); }; document.getElementById('tabLect').onclick=()=>renderAdminLectures(); document.getElementById('tabInst').onclick=()=>renderAdminLecturers(); document.getElementById('tabImp').onclick=()=>renderAdminImportExport(); renderAdminLectures(); }

function renderAdminLectures(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const form=document.createElement('form'); const hourOptions=HOURS.map(h=>'<option value="'+h+'">'+to12(h)+'</option>').join(''); const minuteOptions='<option value=\"0\">00</option><option value=\"30\">30</option>'; const instOptions='<option value=\"\">Ø§Ø®ØªØ± Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>'+DATA.instructors.map(i=>'<option value=\"'+i.id+'\">'+escapeHtml(i.name)+'</option>').join(''); form.innerHTML='<div class=\"row\"><div class=\"col\"><label class=\"kv\">Ø§Ù„ÙŠÙˆÙ…</label><select id=\"fDay\" class=\"input\">'+DAYS.map(d=>'<option value=\"'+d+'\">'+d+'</option>').join('')+'</select></div><div class=\"col\"><label class=\"kv\">Ø¨Ø¯Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class=\"row\"><select id=\"fStartH\" class=\"input\">'+hourOptions+'</select><select id=\"fStartM\" class=\"input\">'+minuteOptions+'</select></div></div></div><div class=\"row\" style=\"margin-top:8px\"><div class=\"col\"><label class=\"kv\">Ù†Ù‡Ø§ÙŠØ© (Ø³Ø§Ø¹Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)</label><div class=\"row\"><select id=\"fEndH\" class=\"input\">'+hourOptions+'</select><select id=\"fEndM\" class=\"input\">'+minuteOptions+'</select></div></div><div class=\"col\"><label class=\"kv\">Ø§Ù„Ù…Ø§Ø¯Ø©</label><input id=\"fTitle\" class=\"input\" placeholder=\"Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©\" required /></div></div><div style=\"margin-top:8px\" class=\"row\"><div class=\"col\"><label class=\"kv\">Ø§Ù„Ø¯ÙƒØªÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><select id=\"fInst\" class=\"input\">'+instOptions+'</select></div><div class=\"col\"><label class=\"kv\">Ø§Ù„Ù…ÙƒØ§Ù† Ø£Ùˆ Ø±Ø§Ø¨Ø·</label><input id=\"fLocation\" class=\"input\" placeholder=\"Ø§Ù„Ù…ÙƒØ§Ù† (Ù‚Ø§Ø¹Ø©) Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©\" /></div></div><textarea id=\"fNotes\" class=\"input\" placeholder=\"Ù…Ù„Ø§Ø­Ø¸Ø§Øª\"></textarea><div style=\"display:flex;justify-content:flex-end;margin-top:8px\"><button class=\"btn\" type=\"submit\">Ø£Ø¶Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button></div>'; body.appendChild(form); form.onsubmit=(e)=>{ e.preventDefault(); const day=document.getElementById('fDay').value; const sh=+document.getElementById('fStartH').value; const sm=+document.getElementById('fStartM').value; const eh=+document.getElementById('fEndH').value; const em=+document.getElementById('fEndM').value; let startNum=sh + (sm>0?0.5:0); let endNum=eh + (em>0?0.5:0); if(endNum<=startNum) endNum = startNum + 1; const startHour=Math.floor(startNum); const endHour=Math.ceil(endNum); const lec={ id: uid(), day, startHour, startMin: sm, endHour, endMin: em, title: document.getElementById('fTitle').value.trim(), instructorId: document.getElementById('fInst').value || null, instructorName: null, location: document.getElementById('fLocation').value.trim(), notes: document.getElementById('fNotes').value.trim(), link: '' }; DATA.lectures.push(lec); saveData(DATA); renderAdminLectures(); renderTable(); }; const list=document.createElement('div'); list.style.marginTop='12px'; if(DATA.lectures.length===0) list.innerHTML='<div class=\"card\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø¨Ø¹Ø¯</div>'; else{ const ul=document.createElement('div'); ul.style.display='grid'; ul.style.gap='8px'; DATA.lectures.forEach(l=>{ const el=document.createElement('div'); el.className='card'; const instName=getInstructorName(l.instructorId) || l.instructorName || ''; el.innerHTML='<div style=\"display:flex;justify-content:space-between;align-items:center\"><div><div style=\"font-weight:800\">'+escapeHtml(l.title)+'</div><div class=\"kv\">'+escapeHtml(l.day)+' '+to12WithMin(l.startHour,l.startMin)+' â€” '+to12WithMin(l.endHour,l.endMin)+' â€¢ '+escapeHtml(instName)+'</div></div><div><button class=\"btn\" data-id=\"'+l.id+'\">Ø­Ø°Ù</button></div></div>'; ul.appendChild(el); }); list.appendChild(ul); list.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=>{ const id=b.getAttribute('data-id'); if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')){ DATA.lectures = DATA.lectures.filter(x=> x.id !== id); saveData(DATA); renderAdminLectures(); renderTable(); } })); } body.appendChild(list); }

function renderAdminLecturers(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const form=document.createElement('form'); form.innerHTML='<div class=\"row\"><div class=\"col\"><input id=\"iName\" class=\"input\" placeholder=\"Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±\" required /></div><div class=\"col\"><input id=\"iTitle\" class=\"input\" placeholder=\"Ø§Ù„ØªØ®ØµØµ/Ø§Ù„Ù…Ø³Ù…Ù‰\" /></div></div><input id=\"iSubjects\" class=\"input\" placeholder=\"Ø§Ù„Ù…ÙˆØ§Ø¯ (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)\" /><textarea id=\"iBio\" class=\"input\" placeholder=\"Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±\"></textarea><div style=\"display:flex;justify-content:flex-end;margin-top:8px\"><button class=\"btn\" type=\"submit\">Ø£Ø¶Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±</button></div>'; body.appendChild(form); form.onsubmit=(e)=>{ e.preventDefault(); const inst={ id: uid(), name: document.getElementById('iName').value.trim(), title: document.getElementById('iTitle').value.trim(), subjects: document.getElementById('iSubjects').value.split(',').map(s=>s.trim()).filter(Boolean), bio: document.getElementById('iBio').value.trim() }; DATA.instructors.push(inst); saveData(DATA); renderAdminLecturers(); renderTable(); }; const list=document.createElement('div'); list.style.marginTop='12px'; if(DATA.instructors.length===0) list.innerHTML='<div class=\"card\">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙƒØ§ØªØ±Ø© Ø¨Ø¹Ø¯</div>'; else{ const ul=document.createElement('div'); ul.style.display='grid'; ul.style.gap='8px'; DATA.instructors.forEach(i=>{ const el=document.createElement('div'); el.className='card'; el.innerHTML='<div style=\"display:flex;justify-content:space-between;align-items:center\"><div><div style=\"font-weight:800\">'+escapeHtml(i.name)+'</div><div class=\"kv\">'+escapeHtml(i.title||'')+'</div></div><div><button class=\"btn\" data-id=\"'+i.id+'\">Ø­Ø°Ù</button></div></div>'; ul.appendChild(el); }); list.appendChild(ul); list.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=>{ const id=b.getAttribute('data-id'); if(confirm('Ø­Ø°Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±ØŸ')){ DATA.instructors = DATA.instructors.filter(x=> x.id!==id); saveData(DATA); renderAdminLecturers(); renderTable(); } })); } body.appendChild(list); }

function renderAdminImportExport(){ const body=document.getElementById('adminBody'); body.innerHTML=''; const exportBtn=document.createElement('button'); exportBtn.className='btn'; exportBtn.innerText='ØªØ­Ù…ÙŠÙ„ JSON'; exportBtn.onclick=()=>{ const a=document.createElement('a'); const blob=new Blob([JSON.stringify(DATA)],{type:'application/json'}); a.href=URL.createObjectURL(blob); a.download='jadwal-v2-backup.json'; a.click(); }; const importBtn=document.createElement('button'); importBtn.className='btn'; importBtn.style.marginLeft='8px'; importBtn.innerText='Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON'; importBtn.onclick=()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=()=>{ const f=inp.files[0]; const reader=new FileReader(); reader.onload=()=>{ try{ DATA = JSON.parse(reader.result); saveData(DATA); renderTable(); renderAdminLectures(); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }catch(e){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); } }; reader.readAsText(f); }; inp.click(); }; body.appendChild(exportBtn); body.appendChild(importBtn); body.appendChild(document.createElement('div')); }

/* Admin flow */
function openAdminFlow(){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const wrap=document.createElement('div'); wrap.className='modal-back'; const m=document.createElement('div'); m.className='modal'; m.innerHTML='<h3>Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3><p class=\"kv\">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p><input id=\"pw\" class=\"input\" type=\"password\" /><div style=\"display:flex;justify-content:flex-end;gap:8px;margin-top:8px\"><button id=\"cancelPw\" class=\"btn\">Ø¥Ù„ØºØ§Ø¡</button><button id=\"submitPw\" class=\"btn\">Ø¯Ø®ÙˆÙ„</button></div>'; wrap.appendChild(m); root.appendChild(wrap); root.style.display='block'; document.getElementById('cancelPw').onclick=()=>{ root.style.display='none'; root.innerHTML=''; }; document.getElementById('submitPw').onclick=()=>{ const v=document.getElementById('pw').value; if(v===ADMIN_PASSWORD){ root.style.display='none'; root.innerHTML=''; openAdmin(); } else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'); }; }

function isNowInLecture(lec){ if(!lec) return false; const now=new Date(); const jsWeek=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const todayName=jsWeek[now.getDay()]; if(lec.day !== todayName) return false; const start=new Date(); start.setHours(lec.startHour, lec.startMin||0,0,0); const end=new Date(); end.setHours(lec.endHour, lec.endMin||0,0,0); return (now >= start && now < end); }

function renderLiveNotice(){ const live=document.getElementById('liveNotice'); const now=new Date(); const jsWeek=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const todayName=jsWeek[now.getDay()]; const todays = DATA.lectures.filter(l=> l.day === todayName).map(l=>{ const start=new Date(); start.setHours(l.startHour, l.startMin||0,0,0); return {l,start}; }).sort((a,b)=> a.start - b.start); const current = DATA.lectures.find(l=> isNowInLecture(l)); if(current){ live.innerText = 'ğŸ•’ Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø­Ø§Ø¶Ø±Ø©: ' + current.title; return; } if(todays.length>0){ const next = todays.find(t=> t.start > now); if(next) live.innerText = 'ğŸ“¢ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ÙŠÙˆÙ…: ' + next.l.title + ' Ø§Ù„Ø³Ø§Ø¹Ø© ' + to12WithMin(next.l.startHour, next.l.startMin||0); else live.innerText='Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ø§Ø­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…'; return;} live.innerText='Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø¢Ù†'; }

/* Print & export/import buttons */
document.getElementById('exportBtn').addEventListener('click', ()=>{ const a=document.createElement('a'); const blob=new Blob([JSON.stringify(DATA)],{type:'application/json'}); a.href=URL.createObjectURL(blob); a.download='jadwal-v2-backup.json'; a.click(); });
document.getElementById('importBtn').addEventListener('click', ()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange = ()=>{ const f=inp.files[0]; const reader=new FileReader(); reader.onload = ()=>{ try{ DATA = JSON.parse(reader.result); saveData(DATA); renderTable(); renderLiveNotice(); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }catch(e){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­'); } }; reader.readAsText(f); }; inp.click(); });

document.getElementById('themeToggle').addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme')==='dark'; document.documentElement.setAttribute('data-theme', cur? '':'dark'); localStorage.setItem('jadwal_theme', cur? 'light':'dark'); });
if(localStorage.getItem('jadwal_theme')==='dark') document.documentElement.setAttribute('data-theme','dark');

document.getElementById('adminBtn').addEventListener('click', ()=> openAdminFlow());
function setupPrint(){ document.getElementById('printBtn').addEventListener('click', ()=>{ const w=window.open('','_blank'); w.document.open(); w.document.write('<!doctype html><html lang=\"ar\" dir=\"rtl\"><head><meta charset=\"utf-8\"/><title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title><style>body{font-family:Arial,sans-serif;padding:16px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ccc;padding:6px;text-align:center}th{background:#f0f0f0}</style></head><body><h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>'+document.getElementById('tableContainer').innerHTML+'<p>ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Khaled El-Reweni</p></body></html>'); w.document.close(); setTimeout(()=>{ w.print(); },600); }); }
setupPrint();

/* initial render & refresh */
renderTable(); renderLiveNotice(); setInterval(()=>{ renderTable(); renderLiveNotice(); },30000);

/* expose API */
window.jadwal_v2 = { data: ()=> JSON.stringify(DATA), clear: ()=>{ if(confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')){ DATA={lectures:[], instructors:[]}; saveData(DATA); renderTable(); renderLiveNotice(); } } };
</script>
</body>
</html>
